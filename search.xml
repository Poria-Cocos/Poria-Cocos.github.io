<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>通用遥控方案【机器人、无人机、遥控车】</title>
      <link href="/aritcles/4fc11e3.html"/>
      <url>/aritcles/4fc11e3.html</url>
      
        <content type="html"><![CDATA[<h1 id="PoriController">PoriController</h1><p>机器人、无人机、遥控车通用遥控方案。PCB、代码全部开源。遥控资源：2个摇杆、8个正面按键、4个三档开关、4个肩键、2个旋转编码器、1个串口屏幕。</p><h2 id="各资源链接">各资源链接</h2><ul><li><a href="https://poria-cocos.github.io/aritcles/4fc11e3.html">项目主页</a>：项目介绍、材料清单</li><li><a href="https://github.com/poria-cocos/PoriController">代码GitHub仓库</a>：固件代码</li><li><a href="https://oshwhub.com/poria_cocos/tong-yong-yao-kong-_poricontroller">原理图和PCB</a>：遥控主板、电池管理板</li></ul>]]></content>
      
      
      <categories>
          
          <category> Projects </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开源 </tag>
            
            <tag> STM32 </tag>
            
            <tag> CUBEMX </tag>
            
            <tag> HAL库 </tag>
            
            <tag> 遥控 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VESC4</title>
      <link href="/aritcles/49a11de3.html"/>
      <url>/aritcles/49a11de3.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>本章将分析 VESC 官方固件中关于 CAN 通信的代码，并介绍如何使用 CAN 总线进行 VESC 多电机控制。</p></blockquote><h1 id="前言">前言</h1><p>推荐没有 CAN 通信软件基础的读者先阅读<a href="https://poria-cocos.github.io/aritcles/fa9b8fb3.html">《一文学会手写CAN通信，CUBEMX+STM32+HAL库》</a></p><p>这篇文章详细讲解了 CAN 收发配置、函数代码，有完整的代码示例，只需略微修改即可适配 VESC CAN 通信。</p><h1 id="VESC-端-CAN-接收">VESC 端 CAN 接收</h1><ul><li>数据帧格式：扩展格式（29位ID）。</li><li>VESC ID：仲裁段（ID）取低8位。</li><li>VESC 指令值：仲裁段（ID）取高21位。</li></ul><h2 id="常用指令表">常用指令表</h2><table><thead><tr><th>指令</th><th>指令值（十进制）</th><th>内容</th><th>数据长度（字节）</th><th>数据类型</th><th>物理单位</th></tr></thead><tbody><tr><td>CAN_PACKET_SET_DUTY</td><td>0</td><td>设置占空比</td><td>4</td><td>int32_t</td><td><code>duty cycle * 1e5</code> (50000 -&gt; 50%)</td></tr><tr><td>CAN_PACKET_SET_CURRENT</td><td>1</td><td>设置电流</td><td>4</td><td>int32_t</td><td>mA</td></tr><tr><td>CAN_PACKET_SET_CURRENT_BRAKE</td><td>2</td><td>设置制动电流</td><td>4</td><td>int32_t</td><td>mA</td></tr><tr><td>CAN_PACKET_SET_RPM</td><td>3</td><td>设置电转速</td><td>4</td><td>int32_t</td><td>erpm</td></tr></tbody></table><p>其余指令可以参考 VESC 官方固件中的 <code>comm_can.c</code> 及 <code>datatypes.h</code> 文件。</p><h2 id="指令发送示例">指令发送示例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">fdcan_send_vesc</span><span class="params">(FDCAN_HandleTypeDef *hfdcan, <span class="type">motor_vesc_t</span> *motor_vesc)</span></span><br><span class="line">&#123;</span><br><span class="line">fdcan_tx_header_vesc.Identifier = (motor_vesc-&gt;cmd &lt;&lt; <span class="number">8</span>) + motor_vesc-&gt;id;</span><br><span class="line">fdcan_tx_header_vesc.IdType = FDCAN_EXTENDED_ID;</span><br><span class="line">fdcan_tx_header_vesc.TxFrameType = FDCAN_DATA_FRAME;</span><br><span class="line">fdcan_tx_header_vesc.DataLength = FDCAN_DLC_BYTES_4;</span><br><span class="line"></span><br><span class="line">fdcan_tx_data_vesc[<span class="number">0</span>] = (motor_vesc-&gt;data &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">fdcan_tx_data_vesc[<span class="number">1</span>] = (motor_vesc-&gt;data &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">fdcan_tx_data_vesc[<span class="number">2</span>] = (motor_vesc-&gt;data &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>;</span><br><span class="line">fdcan_tx_data_vesc[<span class="number">3</span>] = motor_vesc-&gt;data &amp; <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line">HAL_FDCAN_AddMessageToTxFifoQ(hfdcan, &amp;fdcan_tx_header_vesc, fdcan_tx_data_vesc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将指令和 vesc id 打包成 CAN 报文 ID，指令内容作为报文数据段。</p><h1 id="USER-端-CAN-接收">USER 端 CAN 接收</h1><ul><li>数据帧格式：扩展格式（29位ID）。</li><li>VESC ID：仲裁段（ID）取低8位。</li><li>VESC 状态值：仲裁段（ID）取高21位。</li></ul><h2 id="常用状态表">常用状态表</h2><table><thead><tr><th>状态</th><th>状态值（十进制）</th><th>内容</th><th>数据长度（字节）</th><th>数据类型</th></tr></thead><tbody><tr><td>CAN_PACKET_STATUS</td><td>9</td><td>转速、电机电流、占空比</td><td>8</td><td>int32_t, int16_t, int16_t</td></tr><tr><td>CAN_PACKET_STATUS_2</td><td>14</td><td>安时、电池安时</td><td>8</td><td>int32_t, int32_t</td></tr><tr><td>CAN_PACKET_STATUS_3</td><td>15</td><td>瓦时、电池瓦时</td><td>8</td><td>int32_t, int32_t</td></tr><tr><td>CAN_PACKET_STATUS_4</td><td>16</td><td>MOSFET温度、电机温度、输入电流、电机位置</td><td>8</td><td>int16_t, int16_t, int16_t, int16_t</td></tr></tbody></table><p>其余指令可以参考 VESC 官方固件中的 <code>comm_can.c</code> 及 <code>datatypes.h</code> 文件。</p><h2 id="指令接收示例">指令接收示例</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (status)&#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="number">9</span>: <span class="comment">// CAN_PACKET_STATUS</span></span><br><span class="line">    motor-&gt;rpm = (data[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (data[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (data[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">3</span>];</span><br><span class="line">    motor-&gt;current = ((data[<span class="number">4</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">5</span>]);</span><br><span class="line">    motor-&gt;duty = ((data[<span class="number">6</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">7</span>]);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">case</span> <span class="number">14</span>: <span class="comment">// CAN_PACKET_STATUS_2</span></span><br><span class="line">    motor-&gt;amp_hours = (data[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (data[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (data[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">3</span>];</span><br><span class="line">    motor-&gt;amp_hours_charged = (data[<span class="number">4</span>] &lt;&lt; <span class="number">24</span>) | (data[<span class="number">5</span>] &lt;&lt; <span class="number">16</span>) | (data[<span class="number">6</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">7</span>];</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="number">15</span>: <span class="comment">// CAN_PACKET_STATUS_3</span></span><br><span class="line">    motor-&gt;watt_hours = (data[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (data[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (data[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">3</span>];</span><br><span class="line">    motor-&gt;watt_hours_charged = (data[<span class="number">4</span>] &lt;&lt; <span class="number">24</span>) | (data[<span class="number">5</span>] &lt;&lt; <span class="number">16</span>) | (data[<span class="number">6</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">7</span>];</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">case</span> <span class="number">16</span>: <span class="comment">// CAN_PACKET_STATUS_4</span></span><br><span class="line">    motor-&gt;temp_fet = ((data[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">1</span>]);</span><br><span class="line">    motor-&gt;temp_motor = ((data[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">3</span>]);</span><br><span class="line">    motor-&gt;current_in = ((data[<span class="number">4</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">5</span>]);</span><br><span class="line">    motor-&gt;pid_pos_now = ((data[<span class="number">6</span>] &lt;&lt; <span class="number">8</span>) | data[<span class="number">7</span>]);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 <code>data</code> 为接收到的 CAN 报文数据段，为长度为 8 的 uint8_t 数组。</p><h1 id="结尾">结尾</h1><p>VESC 系列教程到这里算是告一段落了。（撒花~）</p><p>粗略涵盖了 原理图、PCB、测试、上位机、软件 全流程，非常感谢你的阅读！</p><p>若有任何疑问，欢迎邮件交流~</p><p><a href="https://poria-cocos.github.io/aritcles/f48d1e60.html#%E7%9B%AE%E5%BD%95"><center>回到目录</center></a></p>]]></content>
      
      
      <categories>
          
          <category> VESC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开源 </tag>
            
            <tag> VESC </tag>
            
            <tag> FOC </tag>
            
            <tag> 无刷电机 </tag>
            
            <tag> ROBOCON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一文学会手写CAN通信，CUBEMX+STM32+HAL库</title>
      <link href="/aritcles/fa9b8fb3.html"/>
      <url>/aritcles/fa9b8fb3.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><blockquote><p>CAN 通信原理、协议格式等内容网络资料丰富，本文几乎不会提及，重心将放在 CUBEMX 配置和 Keil 代码实现上。目的是提供一个通用模版，让读者能够根据数据手册，手写任意产品的 CAN 数据收发代码。</p></blockquote><blockquote><p>本文将默认读者已经粗略了解 CAN 总线相关硬件知识，若文中有不明白的名词，劳烦自行搜索。</p></blockquote><blockquote><p>本文 CUBEMX 配置基于 STM32H7 系列 FDCAN。</p></blockquote><h1 id="报文核心格式">报文核心格式</h1><p>CAN 报文有“帧（Frame）”的概念，一份报文分为数据帧、遥控帧、错误帧、过载帧、帧间空间。而在软件应用中，我们通常只需要关注 <code>数据帧（Data frame）</code>：用于发送单元向接收单元传送数据的帧。</p><p>数据帧由 7 个段构成，如下图，分别为：帧起始、仲裁段、控制段、数据段、CRC段、ACK段、帧结束。</p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/candataframe.png" alt="CAN数据帧"></p><h2 id="帧起始">帧起始</h2><p>表示一个数据帧的开始，1 个显性位。</p><h2 id="仲裁段">仲裁段</h2><p>写明报文 ID，确定发送的帧类型（数据帧 or 遥控帧）。</p><p>在标准格式帧和扩展格式帧中，仲裁段的长度不同：</p><ul><li>标准格式：11 位 ID</li><li>扩展格式：29 位 ID</li></ul><p>对于前 11 位 ID 相同的标准帧和扩展帧，标准帧优先级更高。</p><p>对于两种格式的帧，在应用中我们只需要记住他们的 ID 长度不同即可，其余内容几乎完全一致。</p><h2 id="控制段">控制段</h2><p>指示了数据段的长度。</p><h2 id="数据段">数据段</h2><p>实际要传输的数据，0~8 字节，从 MSB 至 LSB。</p><h2 id="CRC段">CRC段</h2><p>校验段，检测数据在传输过程中是否出错。</p><h2 id="ACK段">ACK段</h2><p>接收单元通过 ACK 段通知发送单元数据是否正确接收。</p><h2 id="帧结束">帧结束</h2><p>表示一个数据帧的结束，7 个隐性位。</p><h1 id="CUBEMX配置">CUBEMX配置</h1><p>起手丝滑小连招，新建工程、选芯片、配时钟树等常规流程，此处跳过。</p><p>Connectivity 中选择 FDCAN1，选中 Activated，进入配置界面。（FDCAN 包含了普通 CAN，看懂 FDCAN 就两个都懂了）</p><h2 id="FDCAN参数详解">FDCAN参数详解</h2><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/canconfig.png" alt="FDCAN参数"></p><blockquote><p>注：以下参数若标明 <code>根据计算得出</code>，则先不必纠结具体数值，后文会讲解如何计算。</p></blockquote><ul><li><p>Frame Format：<code>Classic mode</code>，经典 CAN 模式（CAN2.0）。</p></li><li><p>Mode：Normal。</p></li><li><p>Auto Retransmission（自动重发）：<code>Disable</code>。根据需求，多个节点发生阻塞情况可能需要开启。</p></li><li><p>Transmit Pause（发送延时）：<code>Disable</code>。FDCAN 特有的选项，通常用不到。</p></li><li><p>Protocol Exception（协议异常处理）：<code>Disable</code>。常规应用一般用不到，Enable 也可。</p></li><li><p>Nominal Sync Jump Width（仲裁段同步跳转宽度）：<code>根据计算得出</code>。用于调整时钟同步的容差范围。</p></li><li><p>Data Prescaler（数据段预分频器）：<code>根据计算得出</code>。时钟分频。</p></li><li><p>Data Sync Jump Width（数据段同步跳转宽度）：<code>根据计算得出</code>。</p></li><li><p>Data Time Seg1、Data Time Seg2（数据段时间段）：<code>根据计算得出</code>。数据段采样点位置。</p></li><li><p>Message Ram Offset（消息 RAM 地址偏移）：<code>根据计算得出</code>。此 RAM 是所有 FDCAN 共用的，如果配置了多路 FDCAN，强烈建议设置此偏移参数。</p></li><li><p>Std Filters Nbr（标准格式过滤器数量）：标准格式滤波器数量，用于在仲裁段过滤（11 位）ID。如果外设为标准格式 CAN，此参数至少为 1。</p></li><li><p>Ext Filters Nbr（扩展格式过滤器数量）：扩展格式滤波器数量，用于在仲裁段过滤（29 位）ID。如果外设为扩展格式 CAN，此参数至少为 1。</p></li><li><p>Rx Fifo0 Elmts Nbr、Rx Fifo1 Elmts Nbr（接收 FIFO 的数量）：这两个 FIFO 相互独立，如果只用一个，另一个可以直接填 0。具体需要的数量受外设数量、外设发送频率影响，可以尽量开大些。</p></li><li><p>Rx Fifo0 Elmt Size、Rx Fifo1 Elmt Size（每个 FIFO 的大小）：通常 <code>8 bytes data field</code> 即可，一个数据段最大也就 8 字节。</p><blockquote><p>注：Fifo Elmts Nbr 和 Fifo Elmt Size 两个参数的严格计算方式笔者理解不深，但通常不影响应用，这里贴上一篇笔者读过的文章<a href="https://zhuanlan.zhihu.com/p/714301640">《STM32H7系列FDCAN配置成经典CAN的经验教程和注意事项》</a>，供参考。</p></blockquote></li><li><p>Rx Buffers Nbr、Rx Buffer Size（接收缓冲区数量、大小）：<code>0</code>。如果用 FIFO 就不需要缓冲区，填 0 即可。</p></li><li><p>Tx Events Nbr、Tx Buffers Nbr（发送事件数量、发送缓冲区数量）：<code>0</code>。如果不使用 Events 和 Buffers 发送，填 0 即可。</p></li><li><p>Tx Fifo Queue Elmts Nbr（发送 FIFO 队列数量）：和接收的类似。</p></li><li><p>Tx Fifo Queue Mode（发送 FIFO 队列模式）：<code>FIFO mode</code>。使用 FIFO 模式。</p></li><li><p>Tx Elmt Size（每个发送区的大小）：通常 <code>8 bytes data field</code> 即可。</p></li><li><p>Bit Timings Parameters（仲裁段时间参数）：<code>根据计算得出</code>。和前面数据段类似，经典 CAN 要求仲裁段和数据段波特率一致，填写一样的参数即可。</p></li></ul><h2 id="FDCAN参数计算">FDCAN参数计算</h2><h3 id="数据段-仲裁段波特率">数据段/仲裁段波特率</h3><blockquote><p>包含 Data Prescaler、Data Sync Jump Width、Data Time Seg1、Data Time Seg2、Norminal Prescaler、Nominal Time Seg1、Nominal Time Seg2 参数。</p></blockquote><p>先放一个公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>B</mi><mi>a</mi><mi>u</mi><mi>d</mi><mi>R</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mi>F</mi><mi>D</mi><mi>C</mi><mi>A</mi><mi>N</mi><mi>F</mi><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>y</mi><mo>÷</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>r</mi></mrow><mrow><mn>1</mn><mo>+</mo><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>S</mi><mi>e</mi><mi>g</mi><mn>1</mn><mo>+</mo><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>S</mi><mi>e</mi><mi>g</mi><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">BaudRate = \frac{FDCANFrequency \div Prescaler}{1 + TimeSeg1 + TimeSeg2} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal">u</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">im</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">NF</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">cy</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">resc</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>这里了解即可，具体计算推荐使用 CAN 波特率计算器。</p><ul><li><p>FDCANFrequency：FDCAN 外设时钟频率，单位 Hz。从时钟树中可以找到。</p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/canclock.png" alt="CAN时钟频率"></p></li><li><p>Prescaler：预分频器，分频后得到一个更小的频率。</p></li><li><p>TimeSeg1、TimeSeg2：采样点位置。</p></li></ul><p>推荐一个好用的 CAN 波特率计算器：<a href="https://www.zlg.cn/can/down/down/id/22.html">ZCANPRO 致远电子</a></p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/zcanpro.png" alt="zcanpro"></p><p>下载后，打开 <code>ZBaudcalTool.exe</code>。（整个文件夹包含的工具很多，所以比较大，要是能把 ZBaudcalTool 单独拎出来就好了）</p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/zbaudcaltool.png" alt="zbaudcaltool"></p><ol><li>设备类型选择 CANFDNET_TCP 或 CANFDNET_UDP</li></ol><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/cancal1.png" alt="cancal1"></p><ol start="2"><li>填写时钟频率（上文的 FDCANFrequency）、想要的波特率、允许误差。</li></ol><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/cancal2.png" alt="cancal2"></p><ol start="3"><li>选择一组合适的参数，其中：</li></ol><ul><li>BPR 应尽量小，以保证 Tq 尽可能小，减少误差；</li><li>采样点推荐范围：75%~87.5%；</li><li>波特率 &lt;= 500 kbps时，推荐采样点87.5%；</li><li>波特率 &gt; 500 kbps时，推荐采样点80%；</li><li>波特率 &gt; 800 kbps时，推荐采样点75%。</li><li>注意 CUBEMX 中参数的可填写范围</li></ul><p>这里我们选择了一组合适的参数，然后修改同步跳转宽度（Sync Jump Width），应尽量大且尽量与 TSEG2 一致。</p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/cancal3.png" alt="cancal3"></p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/cancal4.png" alt="cancal4"></p><p>然后就可以将这组参数填入 CUBEMX 中，填好后如下图。</p><div style="display: flex; gap: 16px; align-items: flex-start;">  <img src="https://img-host-3w9.pages.dev/img/article/Tech-can/cancal5.png" alt="1" style="height: 120px;">  <img src="https://img-host-3w9.pages.dev/img/article/Tech-can/cancal6.png" alt="2" style="height: 120px;"></div><h3 id="消息RAM地址偏移（Message-Ram-Offset）">消息RAM地址偏移（Message Ram Offset）</h3><p>STM32H7 中，多路 CAN 是共用一个 RAM 的，如果配置不当，设备一多很容易出现丢包、无法通信的情况。</p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/canram.png" alt="canram"></p><p>上图出自 ST 的<a href="https://www.st.com/content/ccc/resource/technical/document/application_note/group1/98/6e/46/61/6e/2e/45/b0/DM00625700/files/DM00625700.pdf/jcr:content/translations/en.DM00625700.pdf">《AN5348 Introduction to FDCAN peripherals for STM32 MCUs》</a></p><p>一路 CAN可以分配最大 2560 words 的 RAM 空间，当我们使用多路 CAN 时，应该给除第一路 CAN 外的其他 CAN 配置 RAM 偏移地址。</p><p>比如使用 3 路 CAN，最简单的方式就是：FDCAN1 偏移填 0，FDCAN2 偏移填 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2560</mn><mo>⋅</mo><mfrac><mn>1</mn><mn>3</mn></mfrac><mo>=</mo><mn>853</mn></mrow><annotation encoding="application/x-tex">2560 \cdot \frac{1}{3} = 853</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2560</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">853</span></span></span></span>，FDCAN3 偏移填 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2560</mn><mo>⋅</mo><mfrac><mn>2</mn><mn>3</mn></mfrac><mo>=</mo><mn>1706</mn></mrow><annotation encoding="application/x-tex">2560 \cdot \frac{2}{3} = 1706</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2560</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1706</span></span></span></span>。填写时注意进制。</p><h2 id="开启中断">开启中断</h2><p>进入 NVIC Settings，打开 FDCAN 中断</p><p><img src="https://img-host-3w9.pages.dev/img/article/Tech-can/canirq.png" alt="canirq"></p><h2 id="生成代码">生成代码</h2><p>配置好工程其他设置，就可以生成代码了。</p><h1 id="Keil代码">Keil代码</h1><h2 id="定义CAN过滤器初始化函数">定义CAN过滤器初始化函数</h2><p>过滤器是 CAN 通信中非常重要的一部分，即使不需要过滤任何数据，也 <strong>必须</strong> 配置过滤器，不然无法正常通信。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">fdcan_filter_init</span><span class="params">(FDCAN_HandleTypeDef *hfdcan)</span>&#123;</span><br><span class="line">FDCAN_FilterTypeDef fdcan_filter;</span><br><span class="line"></span><br><span class="line">fdcan_filter.IdType = FDCAN_STANDARD_ID;</span><br><span class="line">fdcan_filter.FilterIndex = <span class="number">0</span>;</span><br><span class="line">fdcan_filter.FilterType = FDCAN_FILTER_MASK;</span><br><span class="line">fdcan_filter.FilterConfig = FDCAN_FILTER_TO_RXFIFO0;<span class="comment">// FIFO0</span></span><br><span class="line">fdcan_filter.FilterID1 = <span class="number">0x00</span>;</span><br><span class="line">fdcan_filter.FilterID2 = <span class="number">0x00</span>;</span><br><span class="line">HAL_FDCAN_ConfigFilter(hfdcan,&amp;fdcan_filter);</span><br><span class="line">HAL_FDCAN_ConfigGlobalFilter(hfdcan,FDCAN_REJECT,FDCAN_REJECT,FDCAN_REJECT_REMOTE,FDCAN_REJECT_REMOTE);</span><br><span class="line">HAL_FDCAN_ConfigFifoWatermark(hfdcan, FDCAN_CFG_RX_FIFO0, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>FDCAN_FilterTypeDef 结构体的每个参数，在 <code>stm32h7xx_hal_fdcan.h</code> 文件中都有很详细地说明，在这里简单概括下。</p><ul><li><code>IdType</code>：帧格式。标准格式（FDCAN_STANDARD_ID）或扩展格式（FDCAN_EXTENDED_ID）。</li><li><code>FilterIndex</code>：过滤器编号，从 0 开始。标准帧最多 128 个，扩展帧最多 64 个。</li><li><code>FilterType</code>、<code>FilterID1</code>、<code>FilterID2</code>：第一个参数是过滤器类型，后两个参数与 <code>FilterType</code> 配合。类型共 4 种，FDCAN_FILTER_RANGE（接收 ID 在 ID1~ID2 的消息，包含 ID1、ID2）、FDCAN_FILTER_DUAL（只接收 ID 等于 ID1 或 ID2 的消息）、FDCAN_FILTER_MASK（ID2 作为掩码，对比消息 ID 和 ID1，只接收掩码位相等的消息）、FDCAN_FILTER_RANGE_NO_EIDM（接收 ID 在 ID1~ID2 的消息，包含 ID1、ID2，但不应用 EIDM mask）。<br>关于掩码模式，如果 ID2 设为 0，那么就没有掩码位，也就不会过滤任何消息。所以无需过滤消息的场景中，通常都会配置成 <code>掩码模式</code>、<code>ID1=0</code>、<code>ID2=0</code>。</li></ul><p><code>HAL_FDCAN_ConfigFilter(hfdcan,&amp;fdcan_filter);</code>：调用函数，应用过滤器配置。</p><p><code>HAL_FDCAN_ConfigGlobalFilter(FDCAN_HandleTypeDef *hfdcan, uint32_t NonMatchingStd, uint32_t NonMatchingExt, uint32_t RejectRemoteStd, uint32_t RejectRemoteExt)</code>：决定如何处理未与过滤器匹配的数据帧，以及全部遥控帧。</p><ul><li><code>NonMatchingStd</code>：如何处理未与过滤器匹配的标准帧。</li><li><code>NonMatchingExt</code>：如何处理未与过滤器匹配的扩展帧。<br>上述两个参数的可选项有 <code>FDCAN_ACCEPT_IN_RX_FIFO0</code>、<code>FDCAN_ACCEPT_IN_RX_FIFO1</code>、<code>FDCAN_REJECT</code>，分别表示接收至 FIFO0、FIFO1 和拒绝。</li><li><code>RejectRemoteStd</code>：是否拒绝标准格式的遥控帧。</li><li><code>RejectRemoteExt</code>：是否拒绝扩展格式的遥控帧。<br>上述两个参数的可选项有 <code>FDCAN_FILTER_REMOTE</code>、<code>FDCAN_REJECT_REMOTE</code>，分别表示放入过滤器或拒绝。</li></ul><p><code>HAL_FDCAN_ConfigFifoWatermark(FDCAN_HandleTypeDef *hfdcan, uint32_t FIFO, uint32_t Watermark)</code>：配置 FIFO 的水位线，当 FIFO 中消息量达到水位线（阈值）时，触发中断。</p><h2 id="CAN-初始化（main-c）">CAN 初始化（main.c）</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">fdcan_filter_init(&amp;hfdcan1); <span class="comment">// 初始化过滤器</span></span><br><span class="line">HAL_FDCAN_Start(&amp;hfdcan1); <span class="comment">// 启动！</span></span><br><span class="line">HAL_FDCAN_ActivateNotification(hfdcan, FDCAN_IT_RX_FIFO0_WATERMARK, <span class="number">0</span>); <span class="comment">// 开启 FIFO0 水位线中断</span></span><br><span class="line">HAL_FDCAN_ActivateNotification(hfdcan, FDCAN_IT_BUS_OFF, <span class="number">0</span>); <span class="comment">// 开启总线离线中断，可选</span></span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br></pre></td></tr></table></figure><h2 id="消息接收">消息接收</h2><h3 id="重写中断回调函数">重写中断回调函数</h3><p>接收的消息触发水位线中断时，会进入此函数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_FDCAN_RxFifo0Callback</span><span class="params">(FDCAN_HandleTypeDef *hfdcan, <span class="type">uint32_t</span> RxFifo0ITs)</span>&#123;</span><br><span class="line"><span class="keyword">if</span> (hfdcan == &amp;hfdcan1)</span><br><span class="line">&#123;</span><br><span class="line">FDCAN1RCV(&amp;hfdcan1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (hfdcan == &amp;hfdcan2)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (hfdcan == &amp;hfdcan3)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="定义消息处理函数">定义消息处理函数</h3><p>这里提供两种形式，都可以使用。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">FDCAN1RCV</span><span class="params">(FDCAN_HandleTypeDef *hfdcan)</span>&#123;</span><br><span class="line">  FDCAN_RxHeaderTypeDef rx_header;</span><br><span class="line">  <span class="type">uint8_t</span> rx_data[<span class="number">8</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  <span class="keyword">if</span> (HAL_FDCAN_GetRxMessage(hfdcan, FDCAN_RX_FIFO0, &amp;rx_header, rx_data) == HAL_OK) &#123;</span><br><span class="line"><span class="type">uint8_t</span> id = rx_header.Identifier &amp; <span class="number">0xFF</span>; <span class="comment">// 根据需求修改</span></span><br><span class="line">    <span class="comment">// ... rx_data数据处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>rx_data 这个数组就是数据段（Data Field）中的数据。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">FDCAN1RCV</span><span class="params">(FDCAN_HandleTypeDef *hfdcan)</span>&#123;</span><br><span class="line">  <span class="type">uint16_t</span> id;</span><br><span class="line">  <span class="type">uint8_t</span> rx_data[<span class="number">8</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">  fdcanx_receive(&amp;hfdcan2, &amp;id, rx_data);</span><br><span class="line">  <span class="comment">// ... rx_data数据处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="消息发送">消息发送</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FDCAN_TxHeaderTypeDef fdcan_tx_header;</span><br><span class="line"><span class="type">uint8_t</span> fdcan_tx_data[<span class="number">8</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">FDCANSend</span><span class="params">(FDCAN_HandleTypeDef *hfdcan, <span class="type">uint16_t</span> id, <span class="type">uint8_t</span>* tx_data)</span>&#123;</span><br><span class="line">  fdcan_tx_header.Identifier = id; <span class="comment">// 报文ID</span></span><br><span class="line">  fdcan_tx_header.IdType = FDCAN_STANDARD_ID; <span class="comment">// 帧格式</span></span><br><span class="line">  fdcan_tx_header.TxFrameType = FDCAN_DATA_FRAME; <span class="comment">// 帧类型</span></span><br><span class="line">  fdcan_tx_header.DataLength = FDCAN_DLC_BYTES_8; <span class="comment">// 数据长度</span></span><br><span class="line"></span><br><span class="line">  fdcan_tx_data[<span class="number">0</span>] = tx_data[<span class="number">0</span>];</span><br><span class="line">  fdcan_tx_data[<span class="number">1</span>] = tx_data[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">// ...fdcan_tx_data消息发送数组赋值</span></span><br><span class="line"></span><br><span class="line">  HAL_FDCAN_AddMessageToTxFifoQ(hfdcan, &amp;fdcan_tx_header, fdcan_tx_data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发送函数的传入参数根据实际情况修改，定义之后在需要发送消息时调用即可。</p><h1 id="结语">结语</h1><p>至此，配置、应用 CAN 通信的流程就全部结束了，望本篇文章能让你有所收获，若有表述错误，恳请指正。</p>]]></content>
      
      
      <categories>
          
          <category> STM32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STM32 </tag>
            
            <tag> CUBEMX </tag>
            
            <tag> HAL库 </tag>
            
            <tag> CAN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CUBEMX+STM32+HAL库 串口中断不定长度数据收发</title>
      <link href="/aritcles/ef261100.html"/>
      <url>/aritcles/ef261100.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><blockquote><p>若无特殊说明，串口配置默认为115200 Baud，8位数据位，1位停止位，无校验位。</p></blockquote><h1 id="中断，回调？">中断，回调？</h1><p><strong>中断</strong>：是一种硬件机制，当外设或特定事件发生时，CPU会暂停当前任务，转而执行对应的中断服务程序（ISR），处理完毕后再返回原任务。</p><p><strong>中断回调</strong>：是软件层面的机制。当中断发生并被ISR捕获后，HAL库会自动调用用户自定义的回调函数，用户仅需在回调中编写具体的处理逻辑。</p><p><strong>核心思路</strong>：每接收1个字节数据，就触发1次中断，进入中断回调函数。若检测到包头，开始将数据存入缓冲区，并更新索引。达到指定长度，或接收到包尾后，进入数据处理函数。</p><h1 id="CUBEMX配置">CUBEMX配置</h1><h2 id="新建工程">新建工程</h2><p>新建CUBEMX工程（略），打开串口配置页面，选择异步模式，其余配置保持默认。</p><p><img src="https://img-host-3w9.pages.dev/img/article/STM32/uart1.png" alt="uart1"></p><h2 id="配置中断">配置中断</h2><p>在NVIC配置页面，勾选USARTx global interrupt，启用串口中断。</p><p><img src="https://img-host-3w9.pages.dev/img/article/STM32/uartit1.png" alt="uartit1"></p><h2 id="生成代码">生成代码</h2><p>配置工程名、Code Generator等基本设置，生成代码。</p><p><img src="https://img-host-3w9.pages.dev/img/article/STM32/uart4.png" alt="uart4"></p><h1 id="Keil代码">Keil代码</h1><h2 id="函数介绍">函数介绍</h2><p>HAL库的普通串口中断接收函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_UART_Receive_IT(UART_HandleTypeDef *huart, <span class="type">uint8_t</span> *pData, <span class="type">uint16_t</span> Size)</span><br></pre></td></tr></table></figure><p>其中，三个参数分别为串口号、首位接收数据地址、数据长度。</p><p>串口中断回调函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_UART_RxCpltCallback</span><span class="params">(UART_HandleTypeDef *huart)</span>&#123;</span><br><span class="line">    <span class="comment">// 接收完成后的处理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="初始化">初始化</h2><ul><li><p>定义接收缓冲区、数据索引和数据存放缓冲区变量</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint8_t</span> rx_buf = <span class="number">0</span>;</span><br><span class="line"><span class="type">uint8_t</span> rx_idx = <span class="number">0</span>;</span><br><span class="line"><span class="type">uint8_t</span> UART1_RX_BUF[<span class="number">32</span>];</span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br></pre></td></tr></table></figure></li><li><p>开启串口中断接收</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">HAL_UART_Receive_IT(&amp;huart1, &amp;rx_buf, <span class="number">1</span>);</span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="重写中断回调函数">重写中断回调函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line"><span class="comment">// 假设数据包格式为：AA BB（包头） + 12字节数据 + CC DD（包尾）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_UART_RxCpltCallback</span><span class="params">(UART_HandleTypeDef *huart)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(huart-&gt;Instance == USART1)&#123;</span><br><span class="line">    <span class="keyword">if</span>(rx_idx == <span class="number">0</span> &amp;&amp; rx_buf != <span class="number">0xAA</span>)&#123; <span class="comment">// 检验包头1</span></span><br><span class="line">      HAL_UART_Receive_IT(&amp;huart1, &amp;rx_buf, <span class="number">1</span>); <span class="comment">// 若包头错误则不处理数据，直接重启接收</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123; <span class="comment">// 包头正确，存数据</span></span><br><span class="line">      UART1_RX_BUF[rx_idx++] = rx_buf;</span><br><span class="line">      <span class="keyword">if</span>(rx_idx == <span class="number">16</span>)&#123; <span class="comment">// 达到数据长度</span></span><br><span class="line">        rx_idx = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(UART1_RX_BUF[<span class="number">1</span>] == <span class="number">0xBB</span>)&#123; <span class="comment">// 检验包头2</span></span><br><span class="line">          DataReceive(UART1_RX_BUF); <span class="comment">// 数据处理函数，由用户实现，建议含包尾检验</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      HAL_UART_Receive_IT(&amp;huart1, &amp;rx_buf, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 4 */</span></span><br></pre></td></tr></table></figure><ul><li>若包中数据长度未知，则可以将<code>if(rx_idx == 16)</code>的判定条件改为<code>if(rx_idx &gt;= 2 &amp;&amp; UART1_RX_BUF[rx_idx-1] == 0xDD &amp;&amp; UART1_RX_BUF[rx_idx-2] == 0xCC)</code>，即检测到包尾时进入数据处理函数。</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> STM32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STM32 </tag>
            
            <tag> CUBEMX </tag>
            
            <tag> HAL库 </tag>
            
            <tag> Keil </tag>
            
            <tag> UART </tag>
            
            <tag> 中断 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于 Butterfly 主题下 Fontawesome 图标显示为 X 的问题</title>
      <link href="/aritcles/7644c592.html"/>
      <url>/aritcles/7644c592.html</url>
      
        <content type="html"><![CDATA[<h1 id="问题描述">问题描述</h1><p>直接上图，左图正常显示，右图显示错误：</p><div style="display: flex; gap: 16px; align-items: flex-start;">  <img src="https://img-host-3w9.pages.dev/img/article/Issues/Issues-Fontawesome-1.png" alt="1" style="height: 80px;">  <img src="https://img-host-3w9.pages.dev/img/article/Issues/Issues-Fontawesome-2.png" alt="2" style="height: 80px;"></div><h1 id="相关配置代码">相关配置代码</h1><p>在Butterfly主题的 <code>_config.butterfly.yml</code> 文件中，用于美化页面的标题，相关配置如下：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Configuration for beautifying the content of the article</span></span><br><span class="line"><span class="attr">beautify:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Specify the field to beautify (site or post)</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="comment"># Specify the icon to be used as a prefix for the title, such as &#x27;\f0c1&#x27;</span></span><br><span class="line">  <span class="attr">title_prefix_icon:</span> <span class="string">&#x27;\f0a4&#x27;</span></span><br><span class="line">  <span class="comment"># Specify the color of the title prefix icon, such as &#x27;#F47466&#x27;</span></span><br><span class="line">  <span class="attr">title_prefix_icon_color:</span> <span class="string">&#x27;#F47466&#x27;</span></span><br></pre></td></tr></table></figure><p>笔者在最初配置此项美化时，网页能正常渲染 Fontawesome 图标，但过了几个月后突然发现无法正常显示。查阅相关网页，排除了此段配置代码有误、Fontawesome网站访问异常、图标Unicode错误几个问题。</p><h1 id="解决方案">解决方案</h1><p>在 <code>_config.butterfly.yml</code> 文件中，查找 <code>inject</code> 配置项，添加 Fontawesome 相关的css链接：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css&quot;&gt;</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="comment"># - &lt;script src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>添加后，重新生成并部署，问题解决。</p>]]></content>
      
      
      <categories>
          
          <category> Issues </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Issues </tag>
            
            <tag> Butterfly </tag>
            
            <tag> Fontawesome </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VESC 从零开始制作无刷电机驱动器系列（三）</title>
      <link href="/aritcles/282fe134.html"/>
      <url>/aritcles/282fe134.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>本章将介绍 VESC TOOL 上位机的主要参数与功能。</p><p>笔者优先介绍重要和常用的部分，几乎不用的部分将省略。</p><p>若未特别说明，本文中的电机转速均指电转速，而非输出轴的实际机械转速。</p><p>由于笔者使用的电机驱动 IC 无通信功能，有关故障报错的功能将不作介绍。</p></blockquote><h1 id="页面各部分介绍">页面各部分介绍</h1><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/tool1.png" alt="tool1"></p><h1 id="Motor-Settings">Motor Settings</h1><h2 id="General">General</h2><h3 id="General-2">General</h3><ul><li><strong>Invert Motor Direction</strong>：修改电机正反向定义。</li><li><strong>Sensor Port Mode</strong>：选择电机旋转情况的反馈传感器。</li></ul><h3 id="Current">Current</h3><ul><li><strong>Motor Current Max</strong>：最大驱动电机电流，需考虑电机的承受电流能力。</li><li><strong>Motor Current Max Brake</strong>：最大制动电机电流，需考虑电池的吸收电流能力。</li><li><strong>Absolute Maximum Current</strong>：极限电流，超出后会返回错误，通常设置为尽可能大的值。</li><li><strong>Battery Current Max</strong>：最大电池输出电流。</li><li><strong>Battery Current Max Regen</strong>：最大电池回馈电流，需考虑电池的吸收电流能力。</li></ul><h3 id="Voltage">Voltage</h3><ul><li><strong>Battery Voltage Cutoff Start</strong>：电池保护起始电压，低于此电压时开始限制输出电流，需根据电池实际电压设置。</li><li><strong>Battery Voltage Cutoff End</strong>：电池保护结束电压，低于此电压时停止输出电流，需根据电池实际电压设置。</li></ul><h3 id="RPM">RPM</h3><ul><li><strong>Max ERPM/Max ERPM Reverse</strong>：电机最大转速，需根据电机数据手册设置。</li></ul><h3 id="Advanced">Advanced</h3><ul><li><strong>Minimum Input Voltage</strong>：电池欠压保护。</li><li><strong>Maximum Input Voltage</strong>：电池过压保护。</li><li><strong>Minimum Duty Cycle</strong>：最小驱动占空比。</li><li><strong>Maximum Duty Cycle</strong>：最大驱动占空比。</li><li><strong>Minimum Current</strong>：最小驱动电流。</li></ul><h2 id="FOC">FOC</h2><h3 id="General-3">General</h3><ul><li><strong>Sensor Mode</strong>：选择电机旋转情况的反馈传感器。</li><li><strong>Motor Resistance ®</strong>、<strong>Motor Inductance (L)</strong>、<strong>Motor Flux Linkage (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">{\lambda}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord"><span class="mord mathnormal">λ</span></span></span></span></span>)</strong>、<strong>Current KP</strong>、<strong>Current KI</strong>：自动标定出的参数，不可随意更改，特殊需求时可能需要手动修改。</li></ul><blockquote><p>General下的其他几个页面是不同的传感器参数标定、修改页面。</p></blockquote><h2 id="PID-Controllers">PID Controllers</h2><ul><li><strong>Minimum ERPM</strong>：最小电机转速，小于此值时将不进行转速控制。</li><li><strong>Allow Braking</strong>：是否允许制动。</li><li><strong>Ramp eRPMs per second</strong>：电机转速爬升率，<code>-1</code> 表示无限制。为安全起见并减小电调/电池压力，应根据实际使用情况设置限制值，不建议使用 <code>-1</code>。</li><li><strong>Position Controller</strong>：进行位置环控制时，需用户自行调整 PID 参数。</li></ul><h2 id="Experiments">Experiments</h2><ul><li>进行自定义的电机控制实验</li></ul><h1 id="APP-Settings">APP Settings</h1><h2 id="General-4">General</h2><ul><li><strong>APP to Use</strong>：选择使用的预设。</li><li><strong>VESC ID</strong>：电调的 ID，多电调配置时必须设置，每个电调的 ID 应不同。</li><li><strong>Can Status Message Mode</strong>：CAN 返回报文的信息（详细内容见 CAN 控制篇）。</li><li><strong>Can Status Rate</strong>：CAN 返回报文的频率。</li><li><strong>CAN Baud Rate</strong>：CAN 波特率。</li></ul><h1 id="Data-Analysis">Data Analysis</h1><h2 id="Realtime-Data">Realtime Data</h2><ul><li>电调实时数据采集与显示。</li><li>点击最右侧的 <code>RT</code> 按钮开启功能。</li><li>常用界面包括 <strong>Current</strong> 和 <strong>RPM</strong>。</li></ul><h1 id="结尾">结尾</h1><p>下一章将介绍 VESC 的 CAN 总线控制方法。</p><p><a href="https://poria-cocos.github.io/aritcles/f48d1e60.html#%E7%9B%AE%E5%BD%95"><center>回到目录</center></a></p><p><a href="https://poria-cocos.github.io/aritcles/49a11de3.html"><center>下一章</center></a></p>]]></content>
      
      
      <categories>
          
          <category> VESC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开源 </tag>
            
            <tag> VESC </tag>
            
            <tag> FOC </tag>
            
            <tag> 无刷电机 </tag>
            
            <tag> ROBOCON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VESC 从零开始制作无刷电机驱动器系列（二）</title>
      <link href="/aritcles/65314266.html"/>
      <url>/aritcles/65314266.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>这一章将介绍 VESC 硬件的 PCB 部分，分享布线经验。</p></blockquote><h1 id="PCB设计">PCB设计</h1><h2 id="辅助电源">辅助电源</h2><p>12V 和 5V 两部分所需电流都不大，布线时应优先考虑以下几点：</p><ul><li>减小电感面积。</li><li>减小高频部分铺铜面积。</li></ul><p>这样可以有效降低对其他重要信号的干扰。</p><h2 id="采样信号">采样信号</h2><p>采样部分需要特别注意电流采样，建议：</p><ul><li>采用差分走线。</li><li>避开辅助电源的高频部分。</li></ul><p>没有相关经验的读者建议阅读电流采样 layout 相关的文章。</p><p><strong>注意</strong>：如果模拟部分和数字部分分开供电，应提前规划电流采样放大器等元件的排布，避免后续分割地时出现问题。</p><h2 id="MOS-驱动">MOS 驱动</h2><ul><li>FD6288Q 与 MOSFET 间的连接走线应尽量短且适当加宽。</li><li>6 颗二极管和自举电容应尽量靠近 FD6288Q。</li></ul><h2 id="敏感信号">敏感信号</h2><p>在本设计中，USB、CAN、SWDIO/SWCLK 属于敏感信号，走线时应注意：</p><ul><li>避开辅助电源的高频部分、MOS 驱动信号部分、功率地部分。</li><li>USB 和 CAN 信号应走差分线。</li></ul><p><strong>提示</strong>：若处理不当，可能会导致以下问题：</p><ul><li>校准/驱动电机时 USB 断连。</li><li>CAN 信号受干扰，导致上位 STM32 主动关闭 CAN 收发。</li><li>烧录固件对电源质量要求高。</li></ul><h1 id="焊接调试">焊接调试</h1><blockquote><p>以下为笔者推荐的焊接顺序，有经验的读者也可按照自己的经验焊接。</p></blockquote><ol><li><strong>焊接电源部分</strong>：测试输出电压（务必先焊接共地的 0R 电阻！）。</li><li><strong>焊接单片机相关部分</strong>：连接 ST-Link，打开 Keil 任意工程，点击 -&gt; 魔术棒 -&gt; DEBUG -&gt; Settings，观察是否能读取到芯片（此步可跳过）。</li><li><strong>烧录固件</strong>：推荐使用 STM32CubeProgrammer，若出现问题可尝试 ST-Link Utility。正常烧录成功的表现为红灯闪烁，功耗约 1.5W。</li><li><strong>焊接 USB 部分</strong>：电脑安装驱动并打开上位机，点击 AutoConnect，连接 VESC。</li><li><strong>焊接其余部分</strong>：全部完成后上电，观察功耗，确保工作正常。</li><li><strong>测试波形</strong>：<ul><li>将示波器探头分别置于 GHA（GLA、GHB、GLB、GHC、GLC）网络，依次点击 FOC &gt; RL &gt; OK，测量波形应形似方波。（点击OK后大约只输出1s，所以要提前调好示波器，或使用示波器的STOP）<br><img src="https://img-host-3w9.pages.dev/img/article/VESC/2-1.png" alt="2-1"></li><li>将示波器 CH1 和 CH2 分别置于 GHA 和 GLA（GHB 和 GLB、GHC 和 GLC）网络，依次点击 FOC &gt; RL &gt; OK，应观测到两个方波中的高电平先向低电平降低，低电平再向高电平升高，确保两个管不会同时导通。</li></ul></li></ol><p><strong>注意</strong>：若任何一步出现问题，为安全起见，<strong>绝不可</strong>进入下一步！</p><ol start="7"><li><strong>连接电机</strong>：<ul><li>选择 Welcome &amp; Wizards &gt; Setup Motors FOC，根据实际电机选择合适的型号（建议从偏小的型号开始，避免烧毁电机）。笔者使用的 5065 轮毂电机选择了 ~750g。<br><img src="https://img-host-3w9.pages.dev/img/article/VESC/2-2.png" alt="2-2"></li><li>-&gt; Next：选择对应的电源电压，笔者选择了 6 串（3.0~4.2 * 6 = 18.0~25.2），对应标称 24V 的航模电池。<br><img src="https://img-host-3w9.pages.dev/img/article/VESC/2-3.png" alt="2-3"></li><li>-&gt; Next：通常选择直驱模式，然后根据单个 VESC（no CAN）或多个 VESC 通过 CAN 线连接选择不同的 Run。<br><img src="https://img-host-3w9.pages.dev/img/article/VESC/2-4.png" alt="2-4"></li><li>-&gt; Run：运行后，上位机开始标定参数，电机开始转动。<strong>注意</strong>：确保电源限流充足，同时务必固定好电机底座！</li></ul></li></ol><blockquote><p>至此，初次焊接调试流程已完成。</p></blockquote><h2 id="常见问题">常见问题</h2><ul><li><strong>DCDC 输出异常（如 21V）</strong>：检查共地 0R 电阻是否焊接。</li><li><strong>Keil 显示 no target</strong>：检查 A3V3 部分是否焊接。</li><li><strong>STM32CubeProgrammer 中 ST-Link 名称异常</strong>：如显示单字符 7、D 等，更换 ST-Link，可能需要使用国外进口芯片的 ST-Link，直到显示一长串字符。</li><li><strong>烧录多次失败/运行失败/校验失败</strong>：检查 SWDIO/SWCLK 引脚连通性及硬件问题，更换高质量电源，必要时用 ST-Link Utility 擦除 flash 后重新烧录。</li><li><strong>USB 无法连接</strong>：观察功耗和红色 LED 状态，判断固件是否成功运行。检查 USB 信号线上的 22R 电阻是否焊接。</li></ul><h1 id="结尾">结尾</h1><p>本章主要分享了 PCB layout 和焊接调试的经验。笔者也是第一次设计电机驱动器，难免有疏漏之处，若有疑问或建议，欢迎通过邮件联系笔者。</p><p>下一章将介绍 VESC TOOL 的功能，并分享一些基础使用教程。</p><p><a href="https://poria-cocos.github.io/aritcles/f48d1e60.html#%E7%9B%AE%E5%BD%95"><center>回到目录</center></a></p><p><a href="https://poria-cocos.github.io/aritcles/282fe134.html"><center>下一章</center></a></p>]]></content>
      
      
      <categories>
          
          <category> VESC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开源 </tag>
            
            <tag> VESC </tag>
            
            <tag> FOC </tag>
            
            <tag> 无刷电机 </tag>
            
            <tag> ROBOCON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CUBEMX+STM32+HAL库 串口DMA空闲中断任意数据收发</title>
      <link href="/aritcles/359f00fc.html"/>
      <url>/aritcles/359f00fc.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>本文主要介绍串口的DMA数据搬运与空闲中断的使用，不讨论阻塞式串口收发和普通中断串口收发。</p><blockquote><p>若无特殊说明，串口配置默认为115200 Baud，8位数据位，1位停止位，无校验位。</p></blockquote><h1 id="DMA？空闲中断？">DMA？空闲中断？</h1><ul><li><p><strong>DMA（Direct Memory Access，直接内存访问）</strong>：一种数据传输机制，允许数据在外设和内存之间直接传输，无需CPU介入。</p></li><li><p><strong>串口+DMA</strong>：在串口收发数据的同时，单片机可以执行其他任务。</p></li><li><p><strong>空闲中断</strong>：当总线在一个字节时间内未接收到数据时触发中断，表示数据接收完毕。</p></li></ul><h1 id="CUBEMX配置">CUBEMX配置</h1><h2 id="新建工程">新建工程</h2><p>新建CUBEMX工程（略），打开串口配置页面，选择异步模式，其余配置保持默认。<br><img src="https://img-host-3w9.pages.dev/img/article/STM32/uart1.png" alt="uart1"></p><h2 id="添加DMA">添加DMA</h2><p>在DMA配置页面，添加RX和TX的DMA通道，模式选择Normal。<br><img src="https://img-host-3w9.pages.dev/img/article/STM32/uart2.png" alt="uart2"></p><p>Normal和Circular模式的区别：</p><ul><li><strong>Normal（默认/单次）</strong>：DMA传输完成后停止工作，需要重新启动才能开启下一次传输。</li><li><strong>Circular（循环）</strong>：DMA会持续工作（自动重新启动），不断搬运数据。</li></ul><p>大多数场景下，我们需要对串口数据进行后处理，因此中断尤为重要。本文使用空闲中断，在接收完一轮数据后进入中断处理，处理完成后手动开启下一次DMA接收，因此应配置为Normal模式。</p><h2 id="配置中断">配置中断</h2><p>在NVIC配置页面，开启串口和DMA的全局中断。</p><blockquote><p>配置完DMA后通常会自动开启。<br><img src="https://img-host-3w9.pages.dev/img/article/STM32/uart3.png" alt="uart3"></p></blockquote><h2 id="生成代码">生成代码</h2><p>配置工程名、Code Generator等基本设置，生成代码。<br><img src="https://img-host-3w9.pages.dev/img/article/STM32/uart4.png" alt="uart4"></p><h1 id="Keil代码">Keil代码</h1><h2 id="函数介绍">函数介绍</h2><p>HAL库的DMA串口收发函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HAL_UART_Transmit_DMA(UART_HandleTypeDef *huart, <span class="type">const</span> <span class="type">uint8_t</span> *pData, <span class="type">uint16_t</span> Size)</span><br><span class="line"></span><br><span class="line">HAL_UART_Receive_DMA(UART_HandleTypeDef *huart, <span class="type">uint8_t</span> *pData, <span class="type">uint16_t</span> Size)</span><br></pre></td></tr></table></figure><p>其中，三个参数分别为串口号、首位发送数据地址、数据长度。</p><p>示例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_UART_Transmit_DMA(&amp;huart1, tx_buf, <span class="keyword">sizeof</span>(tx_buf));</span><br></pre></td></tr></table></figure><h2 id="初始化">初始化</h2><ul><li>定义接收数据缓存区：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="type">uint8_t</span> rx_buf[<span class="number">32</span>];</span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br></pre></td></tr></table></figure><p>变量名和大小请根据实际需求修改。</p><ul><li>开启DMA接收与空闲中断：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line">HAL_UARTEx_ReceiveToIdle_DMA(&amp;huart1, rx_buf, <span class="keyword">sizeof</span>(rx_buf));</span><br></pre></td></tr></table></figure><ul><li>关闭半满中断：</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__HAL_DMA_DISABLE_IT(&amp;hdma_usart1_rx, DMA_IT_HT);</span><br><span class="line"><span class="comment">/* USER CODE END 2 */</span></span><br></pre></td></tr></table></figure><p>在HAL库中，调用<code>HAL_UARTEx_ReceiveToIdle_DMA</code>函数后会自动开启半满中断，但大多数场景下仅需传输完一组数据后的空闲中断，因此需手动关闭半满中断。</p><p>需要注意，<code>hdma_usart1_rx</code>仅在usart.c文件中定义，未在usart.h中声明，直接在main.c中使用会报错。因此需在usart.h中添加以下代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN Private defines */</span></span><br><span class="line"><span class="keyword">extern</span> DMA_HandleTypeDef hdma_usart1_rx;</span><br><span class="line"><span class="comment">/* USER CODE END Private defines */</span></span><br></pre></td></tr></table></figure><h2 id="重写中断回调函数">重写中断回调函数</h2><p>中断回调函数在接收一轮数据后触发，数据处理逻辑通常放在此处。在main.c中添加以下代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_UARTEx_RxEventCallback</span><span class="params">(UART_HandleTypeDef *huart, <span class="type">uint16_t</span> Size)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(huart-&gt;Instance == USART1)&#123;</span><br><span class="line">    <span class="comment">// 处理数据的函数或相关语句</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 4 */</span></span><br></pre></td></tr></table></figure><h2 id="开启下一轮接收">开启下一轮接收</h2><p>在<code>stm32fxxx_it.c</code>文件中的以下位置，添加两行代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @brief This function handles USART1 global interrupt.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">USART1_IRQHandler</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN USART1_IRQn 0 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END USART1_IRQn 0 */</span></span><br><span class="line">  HAL_UART_IRQHandler(&amp;huart1);</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN USART1_IRQn 1 */</span></span><br><span class="line">HAL_UARTEx_ReceiveToIdle_DMA(&amp;huart1, rx_buf, <span class="keyword">sizeof</span>(rx_buf));<span class="comment">// 用户添加</span></span><br><span class="line">__HAL_DMA_DISABLE_IT(&amp;hdma_usart1_rx, DMA_IT_HT);<span class="comment">// 用户添加</span></span><br><span class="line">  <span class="comment">/* USER CODE END USART1_IRQn 1 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于<code>rx_buf</code>仅在main.c中定义，因此需在<code>stm32fxxx_it.c</code>中引用：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN PV */</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">uint8_t</span> rx_buf[<span class="number">32</span>];</span><br><span class="line"><span class="comment">/* USER CODE END PV */</span></span><br></pre></td></tr></table></figure><ul><li>注意：重新开启DMA接收与空闲中断的函数<strong>必须</strong>放在USART1_IRQHandler中，<strong>不能</strong>放在HAL_UARTEx_RxEventCallback回调函数中，具体原因将在文章最后说明。</li></ul><h2 id="重写报错回调函数">重写报错回调函数</h2><p>通常情况下，当串口发生错误时，会进入此回调函数，用户可以在函数中进行错误处理、重新开启串口等操作，在main.c中添加以下代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* USER CODE BEGIN 4 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_UART_ErrorCallback</span><span class="params">(UART_HandleTypeDef *huart)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(huart-&gt;Instance == USART1)&#123;</span><br><span class="line">    <span class="comment">// 错误处理函数或相关语句</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 若用户允许忽略错误，可以直接再次开启串口接收，比如：</span></span><br><span class="line">    <span class="comment">// HAL_UARTEx_ReceiveToIdle_DMA(&amp;huart1, rx_buf, sizeof(rx_buf));</span></span><br><span class="line">    <span class="comment">// __HAL_DMA_DISABLE_IT(&amp;hdma_usart1_rx, DMA_IT_HT);</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* USER CODE END 4 */</span></span><br></pre></td></tr></table></figure><h1 id="大坑！">大坑！</h1><p>前文 <strong>开启下一轮接收</strong> 部分提到，重新开启的函数必须放在<code>stm32fxxx_it.c</code>文件下的USART1_IRQHandler函数中。</p><p>很多人习惯在回调函数的最后直接开启下一轮串口接收，从直观感受上似乎也说得通。</p><p>然而，当串口波特率偶然发生变化时，将不会进入回调函数，此轮接收结束后，串口空闲中断和DMA将被关闭。又由于无法进入回调函数，串口空闲中断和DMA无法被重新开启，导致串口接收永久失效！</p><p>如果将重启函数写在USART1_IRQHandler函数中，即使串口波特率发生变化，USART1_IRQHandler函数也会被调用，串口空闲中断和DMA会被重新开启，不影响下一轮数据接收。</p><p>有人可能会说：“我保持一个波特率不就好了？”但实际上并不容易。此处 <strong>串口波特率偶然发生变化</strong> 不仅指用户手动修改波特率，MCU和外设初始化时、设备受到较大震动、串口线缆松动等情况都有可能导致波特率偶然出错。</p><p>举两个惨痛教训：</p><ul><li><p>笔者所在的实验室在调试一套激光定位系统时，分控板连接了4个激光测距模块，有时分控板会突然停止吐数据，发送引脚无任何波形，但进入debug发现串口缓冲区仍有激光的数据更新。当时查了好久，而且一进debug问题就消失了（之后分析是因为进debug使串口被重新初始化，重新打开了接收），最后终于发现没有进回调函数，才醒悟过来是这个问题。推测是定位系统在高速运动时受到震动，串口波特率不稳定。</p></li><li><p>大一某次使用串口屏时，若MCU和串口屏同时上电，表现出串口屏触摸无法被单片机读取的情况；按一下MCU的rst或者进入debug，问题就解决了。当时使用了上电后连续初始化数次，每次间隔一段时间这种蠢办法，才临时解决了这个问题（之后看其实是上电瞬间MCU和串口屏两边波特率没对上，连续初始化的时间让MCU端跨过了这个时间段），其实也是因为重新开启的函数放错位置才导致此问题。</p></li></ul><p>关于这个坑的详细描述及测试，可以参考<a href="https://blog.csdn.net/soledade/article/details/129030082?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-129030082-blog-138068760.235%5Ev43%5Epc_blog_bottom_relevance_base9&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=4"> 《HAL库 串口空闲中断+DMA接收不定长数据 详解及踩坑》 </a>这篇文章，笔者也是有幸读到这篇文章才第一次意识到这个问题。</p>]]></content>
      
      
      <categories>
          
          <category> STM32 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> STM32 </tag>
            
            <tag> CUBEMX </tag>
            
            <tag> HAL库 </tag>
            
            <tag> Keil </tag>
            
            <tag> UART </tag>
            
            <tag> DMA </tag>
            
            <tag> 空闲中断 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VESC 从零开始制作无刷电机驱动器系列（一）</title>
      <link href="/aritcles/5527aebe.html"/>
      <url>/aritcles/5527aebe.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>如果你没有阅读过<a href="https://poria-cocos.github.io/aritcles/f48d1e60.html">《VESC 从零开始制作无刷电机驱动器系列》</a>，建议先跳转阅读。</p><p>VESC 官网链接：<a href="https://vesc-project.com/">https://vesc-project.com/</a></p></blockquote><h1 id="自制-VESC-所需的硬件条件">自制 VESC 所需的硬件条件</h1><ul><li>PCB及元器件</li><li>焊接设备（如电烙铁、热风枪、加热台，或外包SMT）</li><li>安全防护措施完善的电源</li><li>示波器（用于监测电气参数及调试）</li><li>万用表（用于监测电气参数及调试）</li><li>电机</li></ul><h1 id="VESC4-和-VESC6-的区别">VESC4 和 VESC6 的区别</h1><ul><li><strong>VESC4</strong>：两相分流设计，仅测量电机两相线的电流，通过理论计算得出第三相电流。</li><li><strong>VESC6</strong>：三相分流设计，提供更优的性能，支持更高的持续电流。</li><li>官网提供了 VESC4 和 VESC6 的原理图，但仅提供了 VESC4 的 PCB 文件。</li><li>本系列教程基于 VESC6，改进了官网原理图并替换了部分元器件。</li></ul><h1 id="VESC6-原理图分块分析">VESC6 原理图分块分析</h1><p>官网原理图：<a href="https://vesc-project.com/sites/default/files/Benjamin%20Posts/VESC_6.pdf">VESC_6.pdf</a><br>笔者开源原理图：<a href="https://oshwhub.com/roboticlib/vesc6-wu-shua-dian-ji-qu-dong-qi">VESC6 无刷电机驱动器 电调</a></p><h2 id="核心一：MOS驱动">核心一：MOS驱动</h2><h3 id="官方原版">官方原版</h3><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/DRIVE.png" alt="DRIVE"></p><p>官网原理图中，VESC 各版本均使用 DRV8301 作为 MOS 驱动芯片，其信号引脚较多，可分为以下几部分：</p><ul><li><strong>单片机信号引脚</strong>：<code>INH_A/B/C</code>、<code>INL_A/B/C</code>（与单片机输出的 PWM 信号相连），<code>EN_GATE</code>（使能脚），<code>FAULT</code>（故障指示）。</li><li><strong>单片机 SPI 通信引脚</strong>：<code>nSCS</code>、<code>SDI</code>、<code>SDO</code>、<code>SCKL</code>（用于向上位机报告 DRV8301 状态及故障）。</li><li><strong>MOSFET 信号引脚</strong>：<code>GH_A/B/C</code>、<code>SH_A/B/C</code>、<code>GL_A/B/C</code>、<code>SL_A/B/C</code>、<code>BST_A/B/C</code>（与 MOSFET 各脚相连）。</li></ul><p>其余电源相关引脚可参考 TI 数据手册：<a href="https://www.ti.com/cn/lit/ds/symlink/drv8301.pdf">DRV8301</a></p><p>数据手册推荐的应用电路如下图所示：</p><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/datasheet.png" alt="datasheet"></p><h3 id="笔者修改">笔者修改</h3><p>笔者将DRV8301替换成了FD6288Q，做如此替换的优势有：</p><ul><li>FD6288Q 封装面积小，仅相当于DRV8301的1/6左右。</li><li>FD6288Q 引脚数少，几乎仅保留了驱动MOS所必须的引脚，便于布线。</li><li>FD6288Q 周围元件需求少，整块电路占用面积少。</li></ul><p>缺点：</p><ul><li>无通信引脚，主控无法从 MOS 驱动 IC 中读取报错信息。</li></ul><blockquote><p><strong>注意事项</strong>：</p><ul><li>由于设计目标是面向有一定基础的用户，且非商用，常见故障可通过外部快速排查，因此无需从 MOS 驱动 IC 获取报错信息。</li><li>替换后无需修改固件，官方固件可直接适配。</li><li>FD6288Q 焊接难度较高，建议将焊盘拉长并使用热风枪焊接。</li></ul></blockquote><p>下图为笔者的 MOS 驱动电路原理图：</p><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/DRIVE_2.png" alt="DRIVE USER"></p><h2 id="核心二：MOSFET">核心二：MOSFET</h2><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/MOSFET.png" alt="MOSFET"></p><p>上图为 MOS 管连接图，马赛克部分为电流采样，将在后文说明。</p><p>MOS 的选型直接影响电调性能，以下为选型流程：</p><ol><li><strong>耐压</strong>：MOS 管耐压 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>D</mi><mi>S</mi></mrow></msub></mrow><annotation encoding="application/x-tex">{ V_{DS} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 应大于电源电压的 1.5~2 倍。</li><li><strong>电流</strong>：MOS 管的持续/峰值漏源电流 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>D</mi></msub></mrow><annotation encoding="application/x-tex">{ I_D }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 应大于实际需求的相电流。<blockquote><p><strong>注意</strong>：相电流是比电源电流大的。</p></blockquote></li><li><strong>开启电压</strong>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mrow><mi>G</mi><mi>S</mi></mrow></msub></mrow><annotation encoding="application/x-tex">{ V_{GS} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">GS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 应能被 MOS驱动IC 驱动。</li><li><strong>导通电阻</strong>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>D</mi><mi>S</mi><mo stretchy="false">(</mo><mi>O</mi><mi>N</mi><mo stretchy="false">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">{ R_{DS(ON)} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0385em;vertical-align:-0.3552em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">ON</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span></span></span></span></span>，将直接影响电调发热情况，此值越小发热越少。</li><li><strong>门极电荷</strong>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">{ Q_{g} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span>，决定了MOS管的开关速度，开关速度越快，发热越小，但开关损耗越大。此值越小开关速度越快。</li><li><strong>价格</strong>：通常，上述参数越优，价格越高。其中，电压、电流参数为必须条件，其他参数请根据实际需求进行权衡。</li></ol><h2 id="核心三：采样">核心三：采样</h2><h3 id="官方原版-2">官方原版</h3><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/sample_i.png" alt="SAMPLEI"></p><p>上图为相电流采样的连接图。</p><ul><li>电流检测放大器可以更换成任意增益为20V/V的同类器件。</li><li>采样电阻选型时要注意封装和功率，功率应尽量满足所需的最大功率，可以用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><msup><mi>I</mi><mn>2</mn></msup><mo>∗</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">{ P = I^2 * R }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span></span> 来估算。通常，封装越大，功率越高，常见封装选择为 1216、2512、3920 等。</li></ul><p>此外，还有电压采样电路：</p><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/sample_v.png" alt="SAMPLEV"></p><h3 id="笔者修改-2">笔者修改</h3><ul><li>电流采样放大器更换为 INA240A1PWR。</li><li>采样电阻更换为功率 9W 的 3920 封装合金电阻。</li><li>电压采样电阻更换为高精密、低温漂电阻，实际对性能有多大提升并没有进行过比较，考虑成本的情况下使用 1% 电阻就已足够。</li></ul><h2 id="文中总结">文中总结</h2><p>以上三部分是电机驱动器硬件的核心，直接决定了 VESC 的性能和硬件上限。设计时应优先完善这三部分。</p><blockquote><p><strong>注</strong>：MCU 和电机控制算法同样重要，但通常使用开源成熟算法。VESC 的 MCU 和固件已确定，难以替换，因此本文未讨论。</p></blockquote><h2 id="辅助电源">辅助电源</h2><h3 id="官方原版-3">官方原版</h3><p>官方原理图中，MCU 需要 3.3V，CAN 收发器等外设需要 5V，因此需两次降压：</p><ul><li><strong>VCC to 5V</strong>：在DRV8301芯片上，自带一组BUCK控制引脚（BST_BK，PH，VSENSE），将其配置成BUCK降压电路，即可得到5V输出。</li><li><strong>5V to 3.3V</strong>：使用一颗 DCDC 降压芯片（LM3671），将5V电压降到3.3V。</li></ul><h3 id="笔者修改-3">笔者修改</h3><p>在笔者的设计中，FD6288Q需要12V的供电，CAN收发器等一些外设需要5V电压，MCU需要3.3V电压，因此笔者需要降压三次。</p><ul><li><strong>VCC to 12V</strong>：使用一颗DCDC降压芯片，此处使用了MPS推荐的电调供电方案之一<code>MP2460GJ-Z</code>，搭配了MPS专门面向DCDC的电感，优点是整个降压部分占用面积小。</li></ul><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/VCCTO12V.png" alt="VCCTO12V"></p><ul><li><p><strong>VCC to 5V</strong>：和12V使用的相同方案，仅需替换电感和反馈电阻部分。</p><p>没有选择其它芯片的原因是减少用料种类，便于采购、维护。</p><p>没有选择将12V降压至5V，而是直接从VCC降压，是为了避免前级降压出问题导致后级全部瘫痪，尽量确保MCU的正常工作以便读取故障信息。</p></li><li><p><strong>5V to 数字3.3V</strong>：使用一颗LDO，得到低纹波的逻辑电平，保证MCU及控制信号尽量不被干扰。</p></li><li><p><strong>5V to 模拟3.3V</strong>：使用TPS7A2033超低噪声、高PSRR的LDO，提高模拟部分采样精度。</p><blockquote><p>当然，大多数设计中此处和直接数字3.3v使用同一个LDO，精度也基本够了。</p><p>笔者将模拟和数字分开，以及上文的高精密电阻，其实是个人的设计习惯。</p></blockquote></li></ul><h2 id="MCU">MCU</h2><h3 id="官方原版-4">官方原版</h3><p>VESC的MCU选型为STM32F405RGT6，下图为MCU相关引脚配置：<br><img src="https://img-host-3w9.pages.dev/img/article/VESC/MCU.png" alt="MCU"></p><p>在官方原理图中，由于使用了IMU、无线模块，再加上与MOS驱动IC的通信，使用了很多MCU的引脚。如果不需要某些功能，可以删去对应的引脚。</p><h3 id="笔者修改-4">笔者修改</h3><p>笔者删去了IMU、无线模块、与MOS驱动IC通信、部分外部信号输入的引脚，最终对外仅保留了USB、CAN收发、HALL编码器、SPI编码器相关功能的引脚，引脚使用原理图如下：</p><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/MCU_2.png" alt="MCU USER"></p><blockquote><p><strong>注意事项</strong>：</p><ul><li>霍尔编码器信号引脚需拉高，电机温度脚不使用时需拉高。</li><li>各信号脚可加 TVS 保护，推荐 TPSMF05CT1G。</li></ul></blockquote><h2 id="CAN-收发器">CAN 收发器</h2><p>这个没什么好讲的，网上一堆方案，都差不多，重点在走线，下图是笔者的CAN收发器原理图：</p><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/CAN.png" alt="CAN"></p><h1 id="结尾">结尾</h1><p>第一章到此结束，主要分析了 VESC 硬件原理图设计思路，帮助读者快速理解各部分作用。笔者的全部原理图预计于 2025 年下半年开源，届时将补充链接。</p><p>下一章将介绍 VESC 硬件的 PCB 部分，分享布线经验，以及一套焊接调试流程。</p><p><a href="https://poria-cocos.github.io/aritcles/f48d1e60.html#%E7%9B%AE%E5%BD%95"><center>回到目录</center></a></p><p><a href="https://poria-cocos.github.io/aritcles/65314266.html"><center>下一章</center></a></p>]]></content>
      
      
      <categories>
          
          <category> VESC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开源 </tag>
            
            <tag> VESC </tag>
            
            <tag> FOC </tag>
            
            <tag> 无刷电机 </tag>
            
            <tag> ROBOCON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VESC 从零开始制作无刷电机驱动器系列</title>
      <link href="/aritcles/f48d1e60.html"/>
      <url>/aritcles/f48d1e60.html</url>
      
        <content type="html"><![CDATA[<h1 id="目录">目录</h1><p>（更新中…）</p><ul><li><a href="https://poria-cocos.github.io/aritcles/f48d1e60.html">VESC 从零开始制作无刷电机驱动器系列</a></li><li><a href="https://poria-cocos.github.io/aritcles/5527aebe.html">VESC 从零开始制作无刷电机驱动器系列（一）</a></li><li><a href="https://poria-cocos.github.io/aritcles/65314266.html">VESC 从零开始制作无刷电机驱动器系列（二）</a></li><li><a href="https://poria-cocos.github.io/aritcles/282fe134.html">VESC 从零开始制作无刷电机驱动器系列（三）</a></li><li><a href="https://poria-cocos.github.io/aritcles/49a11de3.html">VESC 从零开始制作无刷电机驱动器系列（四）</a></li></ul><h1 id="前言">前言</h1><p>本系列教程面向的是有一定软硬件基础，想要制作或使用VESC的读者。若没有任何软硬件基础或相关经验，<strong>非常不建议</strong>直接制作VESC，如果确实有使用需求，建议购买市面上现成的VESC电调。</p><blockquote><p>如何判断自己的基础是否达到？</p><ul><li>有过绘制PCB、焊接电路板的经历</li><li>有过使用STM32单片机的经历</li><li>有过使用无刷电机的经历</li></ul><p>如果满足以上两条，恭喜你，可以尝试参考本教程开始制作VESC了。</p></blockquote><h1 id="什么是-VESC-？">什么是 VESC ？</h1><h2 id="介绍">介绍</h2><ul><li><p>ESC 是 Electric Speed Controller 的缩写，也就是电子调速控制器，简称电调。</p></li><li><p>VESC是一个开源的ESC，它是按照创建者 Benjamin Vedder 的名字 Vedder 来命名。</p></li><li><p>VESC 主要用于控制无刷电机，最初应用于电动滑板，但由于其高功率和开源的特性，逐渐被广泛应用于电动自行车、无人机、机器人等领域。</p></li><li><p>官网链接：<a href="https://vesc-project.com/">https://vesc-project.com/</a></p></li><li><p>原作者github链接：<a href="https://github.com/vedderb">https://github.com/vedderb</a></p></li></ul><h2 id="特点">特点</h2><ul><li>开源的硬件和软件。</li><li>FOC（Field Oriented Control）控制方式。</li><li>多种通信接口：包括 PPM、UART、CAN、I2C 等。</li><li>可编程：提供上位机和源码，便于二次开发。</li><li>支持多种电机角度监测方案：包括无感、霍尔传感器、编码器、HFI等。</li></ul><h1 id="本系列教程涉及到的主要技术点">本系列教程涉及到的主要技术点</h1><h2 id="硬件">硬件</h2><ul><li>DC-DC 降压电路</li><li>MOSFET 驱动电路</li><li>电流采样电路</li><li>差分布线</li><li>地平面分割</li></ul><h2 id="软件">软件</h2><ul><li>STM32 烧录</li><li>VESC Tool 上位机使用</li><li>CAN、FDCAN 通信</li><li>CUBEMX + STM32 总线控制 VESC</li></ul><h1 id="实物图展示">实物图展示</h1><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/pic.jpg" alt="pic"></p><p><img src="https://img-host-3w9.pages.dev/img/article/VESC/pic1.jpg" alt="pic1"></p>]]></content>
      
      
      <categories>
          
          <category> VESC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 开源 </tag>
            
            <tag> VESC </tag>
            
            <tag> FOC </tag>
            
            <tag> 无刷电机 </tag>
            
            <tag> ROBOCON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于 Hexo 框架下 KaTeX 公式的换行与居中问题</title>
      <link href="/aritcles/91e13f66.html"/>
      <url>/aritcles/91e13f66.html</url>
      
        <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>在使用 Hexo 搭建本网站时，笔者遇到了一些关于 KaTeX 公式渲染的问题。找到解决方案后，特撰写此文记录，供自己和他人参考。</p><h1 id="配置过程">配置过程</h1><p>以下是笔者参考官方文档配置 KaTeX 的过程，此部分内容部分转载自 <a href="https://butterfly.js.org/posts/4aa8abbe/#Math-%E6%95%B8%E5%AD%B8">Butterfly 文档（三）主题配置</a>。</p><ol><li><p>在 <code>_config.butterfly.yml</code> 中将 <code>use</code> 设置为 <code>katex</code>：</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">math:</span></span><br><span class="line">  <span class="comment"># Choose: mathjax, katex</span></span><br><span class="line">  <span class="comment"># Leave it empty if you don&#x27;t need math</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">katex</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hide_scrollbar:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li><li><p>卸载 <code>marked</code> 插件，安装 <a href="https://github.com/hexojs/hexo-renderer-markdown-it">hexo-renderer-markdown-it</a>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm un hexo-renderer-marked --save <span class="comment"># 如果有安装这个的话，卸载</span></span><br><span class="line">npm un hexo-renderer-kramed --save <span class="comment"># 如果有安装这个的话，卸载</span></span><br><span class="line"></span><br><span class="line">npm i hexo-renderer-markdown-it --save <span class="comment"># 需要安装这个渲染插件</span></span><br><span class="line">npm install katex @renbaoshuo/markdown-it-katex <span class="comment">#需要安装这个katex插件</span></span><br></pre></td></tr></table></figure></li><li><p>在 Hexo 根目录的 <code>_config.yml</code> 中添加以下配置：</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">markdown:</span></span><br><span class="line">  <span class="attr">plugins:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;@renbaoshuo/markdown-it-katex&#x27;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="问题：网页内一级目录无法跳转">问题：网页内一级目录无法跳转</h1><p>更换 Markdown 插件后，笔者的网页出现一级目录无法跳转的情况。解决方法是在 <code>_config.yml</code> 中的 <code>markdown</code> 配置中添加以下代码：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">markdown:</span></span><br><span class="line">  <span class="attr">plugins:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;@renbaoshuo/markdown-it-katex&#x27;</span></span><br><span class="line">  <span class="attr">anchors:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>添加后问题即可解决。</p><h1 id="居中">居中</h1><p>最初笔者使用 KaTeX 时，采用 <code>$\mathrm&#123; &#125;$</code> 进行公式编辑，<br>效果如 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">R</mi><mrow><mi mathvariant="normal">D</mi><mi mathvariant="normal">S</mi></mrow></msub><mo>=</mo><mn>3.1</mn><mtext> </mtext><mi mathvariant="normal">m</mi><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">\mathrm{R_ {DS} = 3.1\ m \Omega}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">DS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">3.1</span><span class="mspace"> </span><span class="mord mathrm">mΩ</span></span></span></span></span>，公式会嵌入文本中。如果将公式单独书写在一行中，例如：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$\mathrm&#123;R_ &#123;DS&#125; = 3.1\ m \Omega&#125;$</span><br></pre></td></tr></table></figure><p>渲染效果是公式左对齐，无法自动居中。</p><p>尝试使用 <code>$&#123;  &#125;$</code> 进行公式编辑，效果与 <code>$\mathrm&#123; &#125;$</code> 类似，依然无法居中。</p><p>查阅资料后发现，单个美元符号 <code>$&#123;  &#125;$</code> 包裹表示行内公式，而两个美元符号 <code>$$  $$</code> 包裹表示独立成行的公式。将公式改为独立成行的写法后，可以正常居中渲染，例如：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$$ R_ &#123;DS&#125; = 3.1\ m \Omega $$</span><br></pre></td></tr></table></figure><p>效果如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>R</mi><mrow><mi>D</mi><mi>S</mi></mrow></msub><mo>=</mo><mn>3.1</mn><mtext> </mtext><mi>m</mi><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">R_ {DS} = 3.1\ m \Omega </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">3.1</span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord">Ω</span></span></span></span></span></p><h1 id="换行">换行</h1><p>在 KaTeX 的语法中，使用 <code>\\</code> 或 <code>\newline</code> 表示硬换行。但在 Hexo + Butterfly 搭建的此网页中，这两种方法无法实现换行，公式仍显示在同一行。</p><p>尝试使用独立成行公式的写法 <code>$$  $$</code>，可以实现公式间的换行，例如：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$ R_ &#123;DS&#125; = 3.1\ m \Omega $$</span><br><span class="line"></span><br><span class="line">$$ R_ &#123;DS&#125; = 3.1\ m \Omega $$</span><br></pre></td></tr></table></figure><p>效果如下：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>R</mi><mrow><mi>D</mi><mi>S</mi></mrow></msub><mo>=</mo><mn>3.1</mn><mtext> </mtext><mi>m</mi><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">R_ {DS} = 3.1\ m \Omega </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">3.1</span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord">Ω</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>R</mi><mrow><mi>D</mi><mi>S</mi></mrow></msub><mo>=</mo><mn>3.1</mn><mtext> </mtext><mi>m</mi><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">R_ {DS} = 3.1\ m \Omega </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">3.1</span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord">Ω</span></span></span></span></span></p><p>此外，KaTeX 0.10.0+ 版本会在关系或二元运算符（如 <code>=</code> 或 <code>+</code>）之后插入自动换行符。使用 <code>\allowbreak</code> 可以允许在关系或运算符以外的位置自动换行。</p><p>如果公式过长仍未自动换行，建议检查是否在公式内书写了过多文字。推荐将文字写在公式外部。如果确实需要在公式内书写文字，可以使用 <code>\allowbreak</code> 来允许任意位置的自动换行。</p><h1 id="总结">总结</h1><ul><li>若想让公式嵌入文本，推荐使用 <code>$\mathrm&#123; &#125;$</code> 或 <code>$&#123;  &#125;$</code>。</li><li>若想让公式单独成行且居中，推荐使用 <code>$$  $$</code>。</li><li>KaTeX 支持运算符后的自动换行，公式内尽量避免书写大段文字。必要时可使用 <code>\allowbreak</code> 允许任意位置的自动换行。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Issues </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Issues </tag>
            
            <tag> Butterfly </tag>
            
            <tag> Hexo </tag>
            
            <tag> KaTeX </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数控电源 (CNC_Power_Supply)</title>
      <link href="/aritcles/738a4925.html"/>
      <url>/aritcles/738a4925.html</url>
      
        <content type="html"><![CDATA[<h1 id="赛题要求">赛题要求</h1><p>搭载屏幕显示电压电流数据参数；通过按键或旋钮进行参数设置；输入电压为 5~12V，输出电压与电流可调，具体参数如下：</p><ul><li>电压输出范围：0～12V；</li><li>电压调整步进：0.1V；</li><li>电压测量精度：0.01V；</li><li>电流输出范围：0～2A；</li><li>电流调整步进：0.1A；</li><li>电流测量精度：0.01A。</li></ul><h1 id="设计摘要">设计摘要</h1><p>本系统采用纯数字方案，以EG2104栅极驱动IC为核心，以STM32G474RBT6单片机为控制器，拓扑结构为四开关管的同步Buck-Boost，根据电压、电流输出采样，进行PID闭环控制，从而实现恒压或恒流输出。直流输入电压5-12V，系统输出直流电压0-12V可调、直流电流0-2A可调，步进电压0.1V、步进电流0.1A。系统搭载屏幕显示输出参数，显示精度0.01，支持用户触屏控制。输入输出接口使用XT30，输入支持过压保护、过流保护，输出支持过压保护、恒流自动切换。</p><h1 id="系统方案">系统方案</h1><p>本系统采用双模态、四开关管的同步Buck-Boost拓扑结构作为升降压方案，通过改变单片机的PWM占空比，控制栅极驱动IC改变4颗NMOS的开关，从而获得用户要求的输出。</p><h1 id="器件选型">器件选型</h1><h2 id="主控">主控</h2><p>STM32G474RBT6，最高170 MHz主频，同时具有FPU单元。具有高精度定时器，此应用中输出的PWM频率为200kHz。G474带有可编程运放，所以无需设计外部电路，配置成电压跟随器，即可将内部运放用于电压采样。</p><h2 id="MOSFET">MOSFET</h2><p>因为是高频开关电路，所以MOS管的开关损耗和消耗功率不可忽略。应优先考虑栅极电荷较小、漏源导通电阻较小的MOS管。再根据输入电压，筛选漏源电压、驱动阈值电压小于EG2104供电电压的MOS管。最终，选择了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Q</mi><mrow><mi mathvariant="normal">g</mi><mtext> </mtext><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi></mrow></msub><mo>=</mo><mn>19</mn><mi mathvariant="normal">n</mi><mi mathvariant="normal">C</mi><mo separator="true">,</mo><mtext> </mtext><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">G</mi><mi mathvariant="normal">S</mi></mrow></msub><mo>=</mo><mn>10</mn><mi mathvariant="normal">V</mi><mo separator="true">,</mo><mtext> </mtext><msub><mi mathvariant="normal">R</mi><mrow><mi mathvariant="normal">D</mi><mi mathvariant="normal">S</mi></mrow></msub><mo>=</mo><mn>3.1</mn><mtext> </mtext><mi mathvariant="normal">m</mi><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">\mathrm{ Q_{g \ typ} = 19 nC, \ V_{GS} = 10 V, \ R_{DS} = 3.1\ m \Omega }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">g</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathrm mtight">typ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">19nC</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">GS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">10V</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">DS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">3.1</span><span class="mspace"> </span><span class="mord mathrm">mΩ</span></span></span></span></span> 的IRFH8318PbF。</p><h2 id="屏幕">屏幕</h2><p>采用陶晶驰T1系列2.8寸串口屏，电阻触摸，与MCU仅通过串口DMA通信，减小对主要pid计算速度的影响。</p><h2 id="辅助电源">辅助电源</h2><p>由于需要适应5~12V输入需求，且要能带动屏幕，所以先用DC-DC一级降压至4.8V，再用LDO降至其他所需电压。为了增加模拟采样的精准度，使用了TPS7A20作为模拟3.3V的降压IC，和精密、低压差的REF3025作为模拟2.5V的降压IC。</p><h2 id="电感">电感</h2><h3 id="降压时">降压时</h3><p>已知公式</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mrow><mi>b</mi><mi>u</mi><mi>c</mi><mi>k</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo>×</mo><mo stretchy="false">(</mo><msub><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub><mo>−</mo><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><msub><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub><mo>×</mo><mi mathvariant="normal">Δ</mi><msub><mi>I</mi><mi>L</mi></msub><mo>×</mo><msub><mi>F</mi><mrow><mi>S</mi><mi>W</mi></mrow></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo>×</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mfrac><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><msub><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub></mfrac><mo fence="true">)</mo></mrow></mrow><mrow><mi mathvariant="normal">Δ</mi><msub><mi>I</mi><mi>L</mi></msub><mo>×</mo><msub><mi>F</mi><mrow><mi>S</mi><mi>W</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">L_{buck} = \frac{V_{OUT} \times (V_{IN} - V_{OUT})}{V_{IN} \times \Delta I_L \times F_{SW}} = \frac{V_{OUT} \times \left( 1 - \frac{V_{OUT}}{V_{IN}} \right)}{\Delta I_L \times F_{SW}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.263em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.026em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.19em;"><span style="top:-2.464em;"><span class="pstrut" style="height:3.15em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.38em;"><span class="pstrut" style="height:3.15em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-4.19em;"><span class="pstrut" style="height:3.15em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8886em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.2222em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4103em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.2222em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4453em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>I</mi><mi>L</mi></msub><mo>=</mo><mi>γ</mi><msub><mi>I</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Delta I_L = \gamma I_{OUT} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>式中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">F</mi><mrow><mi mathvariant="normal">S</mi><mi mathvariant="normal">W</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm{ F_{SW} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">SW</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是开关频率，本系统使用 200kHz，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi mathvariant="normal">I</mi><mi mathvariant="normal">L</mi></msub></mrow><annotation encoding="application/x-tex">\mathrm{ \Delta I_L }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">Δ</span><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 是电感的交变电流，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\mathrm{ \gamma }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span> 是交变系统系数，这里选取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>=</mo><mn>0.3</mn></mrow><annotation encoding="application/x-tex">\mathrm{ \gamma = 0.3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">0.3</span></span></span></span></span>。根据公式可知，当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">N</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm{ V_{IN} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">IN</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 不变，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">O</mi><mi mathvariant="normal">U</mi><mi mathvariant="normal">T</mi></mrow></msub><mo>=</mo><mn>0.5</mn><mo>×</mo><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">N</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm{ V_{OUT} = 0.5 \times V_{IN} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">OUT</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">0.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">IN</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> 时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">L</mi><mrow><mi mathvariant="normal">b</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm{ L_{buck} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">buck</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 得最大值。参考题目中 5V 的输入，这里选取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">N</mi></mrow></msub><mo>=</mo><mn>5</mn><mi mathvariant="normal">V</mi><mo separator="true">,</mo><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">O</mi><mi mathvariant="normal">U</mi><mi mathvariant="normal">T</mi></mrow></msub><mo>=</mo><mn>2.5</mn><mi mathvariant="normal">V</mi></mrow><annotation encoding="application/x-tex">\mathrm{ V_{IN} = 5V, V_{OUT} = 2.5V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">IN</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">5V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">OUT</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">2.5V</span></span></span></span></span>，代入公式计算得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi mathvariant="normal">I</mi><mi mathvariant="normal">L</mi></msub><mo>=</mo><mn>0.3</mn><mo>×</mo><mn>2</mn><mi mathvariant="normal">A</mi><mo>=</mo><mn>0.6</mn><mi mathvariant="normal">A</mi><mo separator="true">,</mo><msub><mi mathvariant="normal">L</mi><mrow><mi mathvariant="normal">b</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi></mrow></msub><mo>=</mo><mfrac><mrow><mn>2.5</mn><mi mathvariant="normal">V</mi><mo>×</mo><mo stretchy="false">(</mo><mn>5</mn><mi mathvariant="normal">V</mi><mo>−</mo><mn>2.5</mn><mi mathvariant="normal">V</mi><mo stretchy="false">)</mo></mrow><mrow><mn>5</mn><mi mathvariant="normal">V</mi><mo>×</mo><mn>0.6</mn><mi mathvariant="normal">A</mi><mo>×</mo><mn>200</mn><mi mathvariant="normal">k</mi><mi mathvariant="normal">H</mi><mi mathvariant="normal">z</mi></mrow></mfrac><mo>=</mo><mn>10.42</mn><mi>μ</mi><mi mathvariant="normal">H</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\mathrm{ \Delta I_L = 0.3 \times 2A = 0.6A, L_{buck} = \frac{2.5V \times (5V-2.5V)}{5V \times 0.6A \times 200kHz} = 10.42 \mu H. }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4133em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mord mathrm">Δ</span><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">0.3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm">2A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">0.6A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">buck</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">5V</span><span class="mbin mtight">×</span><span class="mord mathrm mtight">0.6A</span><span class="mbin mtight">×</span><span class="mord mathrm mtight">200kHz</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">2.5V</span><span class="mbin mtight">×</span><span class="mopen mtight">(</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">5V</span><span class="mbin mtight">−</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">2.5V</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">10.42</span><span class="mord mathnormal">μ</span><span class="mord mathrm">H.</span></span></span></span></span></p><p>然后，再根据公式计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">I</mi><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">K</mi><mn>1</mn></mrow></msub><mo>=</mo><msub><mi mathvariant="normal">I</mi><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">O</mi><mi mathvariant="normal">A</mi><mi mathvariant="normal">D</mi></mrow></msub><mo>+</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msub><mi mathvariant="normal">I</mi><mi mathvariant="normal">L</mi></msub></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\mathrm{ I_{LPK1} = I_{LOAD} + \frac{\Delta I_L}{2} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2336em;vertical-align:-0.345em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">LPK1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">LOAD</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8886em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4103em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">Δ</span><span class="mord mtight"><span class="mord mathrm mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathrm mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span> 计算电感峰值电流，得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">I</mi><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">K</mi><mn>1</mn></mrow></msub><mo>=</mo><mn>2</mn><mi mathvariant="normal">A</mi><mo>+</mo><mfrac><mrow><mn>0.6</mn><mi mathvariant="normal">A</mi></mrow><mn>2</mn></mfrac><mo>=</mo><mn>2.3</mn><mi mathvariant="normal">A</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\mathrm{ I_{LPK1} = 2A + \frac{0.6A}{2} = 2.3A. }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">LPK1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">2A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">0.6A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">2.3A.</span></span></span></span></span></p><h3 id="升压时">升压时</h3><p>已知公式</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi>I</mi><mi>L</mi></msub><mo>=</mo><mi>γ</mi><msub><mi>I</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub><mo>=</mo><mi>γ</mi><mfrac><mrow><msub><mi>I</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo>×</mo><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub></mrow><msub><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">\Delta I_L = \gamma I_{IN} = \gamma \frac{I_{OUT} \times V_{OUT}}{V_{IN}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mrow><mi>b</mi><mi>o</mi><mi>o</mi><mi>s</mi><mi>t</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub><mo>×</mo><mo stretchy="false">(</mo><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo>−</mo><msub><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo>×</mo><mi mathvariant="normal">Δ</mi><msub><mi>I</mi><mi>L</mi></msub><mo>×</mo><msub><mi>F</mi><mrow><mi>S</mi><mi>W</mi></mrow></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><msubsup><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow><mn>2</mn></msubsup><mo>×</mo><mo stretchy="false">(</mo><msub><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo>−</mo><msub><mi>V</mi><mrow><mi>I</mi><mi>N</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mi>γ</mi><msub><mi>I</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow></msub><mo>×</mo><msubsup><mi>V</mi><mrow><mi>O</mi><mi>U</mi><mi>T</mi></mrow><mn>2</mn></msubsup><mo>×</mo><msub><mi>F</mi><mrow><mi>S</mi><mi>W</mi></mrow></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">L_{boost} = \frac{V_{IN} \times (V_{OUT} - V_{IN})}{V_{OUT} \times \Delta I_L \times F_{SW}} = \frac{V_{IN}^2 \times (V_{OUT} - V_{IN})}{\gamma I_{OUT} \times V_{OUT}^2 \times F_{SW}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">oos</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.263em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4706em;vertical-align:-0.9795em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4911em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4065em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4247em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2753em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">U</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9795em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>相似地，取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">N</mi></mrow></msub><mo>=</mo><mn>5</mn><mi mathvariant="normal">V</mi></mrow><annotation encoding="application/x-tex">\mathrm{V_{IN} = 5V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">IN</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">5V</span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">O</mi><mi mathvariant="normal">U</mi><mi mathvariant="normal">T</mi></mrow></msub><mo>=</mo><mn>12</mn><mi mathvariant="normal">V</mi></mrow><annotation encoding="application/x-tex">\mathrm{V_{OUT} = 12V}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">OUT</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">12V</span></span></span></span></span> 代入数据计算得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><msub><mi mathvariant="normal">I</mi><mrow><mi mathvariant="normal">L</mi><mn>2</mn></mrow></msub><mo>=</mo><mn>0.3</mn><mo>×</mo><mfrac><mrow><mn>2</mn><mi mathvariant="normal">A</mi><mo>×</mo><mn>12</mn><mi mathvariant="normal">V</mi></mrow><mrow><mn>5</mn><mi mathvariant="normal">V</mi></mrow></mfrac><mo>=</mo><mn>1.44</mn><mi mathvariant="normal">A</mi></mrow><annotation encoding="application/x-tex">\mathrm{\Delta I_{L2} = 0.3 \times \frac{2A \times 12V}{5V} = 1.44A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mord mathrm">Δ</span><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">L2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">0.3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">5V</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2A</span><span class="mbin mtight">×</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">12V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">1.44A</span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">L</mi><mrow><mi mathvariant="normal">b</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi></mrow></msub><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>5</mn><mi mathvariant="normal">V</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>×</mo><mo stretchy="false">(</mo><mn>12</mn><mi mathvariant="normal">V</mi><mo>−</mo><mn>5</mn><mi mathvariant="normal">V</mi><mo stretchy="false">)</mo></mrow><mrow><mn>0.3</mn><mo>×</mo><mn>2</mn><mi mathvariant="normal">A</mi><mo>×</mo><mo stretchy="false">(</mo><mn>12</mn><mi mathvariant="normal">V</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>×</mo><mn>200</mn><mi mathvariant="normal">k</mi><mi mathvariant="normal">H</mi><mi mathvariant="normal">z</mi></mrow></mfrac><mo>=</mo><mn>10.13</mn><mi>μ</mi><mi mathvariant="normal">H</mi></mrow><annotation encoding="application/x-tex">{\mathrm{L_{boost} = \frac{(5V)^2 \times (12V - 5V)}{0.3 \times 2A \times (12V)^2 \times 200kHz} = 10.13\mu H} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.6289em;vertical-align:-0.52em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathrm">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">boost</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1089em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">0.3</span><span class="mbin mtight">×</span><span class="mord mathrm mtight">2A</span><span class="mbin mtight">×</span><span class="mopen mtight">(</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">12V</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">×</span><span class="mord mathrm mtight">200kHz</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">5V</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">×</span><span class="mopen mtight">(</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">12V</span><span class="mbin mtight">−</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">5V</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">10.13</span><span class="mord mathnormal">μ</span><span class="mord mathrm">H</span></span></span></span></span></span></p><p>然后计算电感峰值电流 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">I</mi><mrow><mi mathvariant="normal">L</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">K</mi><mn>2</mn></mrow></msub><mo>=</mo><msub><mi mathvariant="normal">I</mi><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">N</mi></mrow></msub><mo>+</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msub><mi mathvariant="normal">I</mi><mrow><mi mathvariant="normal">L</mi><mn>2</mn></mrow></msub></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mn>2</mn><mi mathvariant="normal">A</mi><mo>×</mo><mn>12</mn><mi mathvariant="normal">V</mi></mrow><mrow><mn>5</mn><mi mathvariant="normal">V</mi></mrow></mfrac><mo>+</mo><mfrac><mrow><mn>1.44</mn><mi mathvariant="normal">A</mi></mrow><mn>2</mn></mfrac><mo>=</mo><mn>5.52</mn><mi mathvariant="normal">A</mi></mrow><annotation encoding="application/x-tex">\mathrm{I_{LPK2} = I_{IN} + \frac{\Delta I_{L2}}{2} = \frac{2A \times 12V}{5V} + \frac{1.44A}{2} = 5.52A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2336em;vertical-align:-0.345em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">LPK2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathrm">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">IN</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8886em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4103em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">Δ</span><span class="mord mtight"><span class="mord mathrm mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathrm mtight">L2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">5V</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2A</span><span class="mbin mtight">×</span><span class="mord mathrm mtight" style="margin-right:0.01389em;">12V</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">1.44A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">5.52A</span></span></span></span></span></p><p>综合上述两种计算结果，选取电感量为15uH，饱和电流为14.5A的一体成型电感。（原理图中为10uH，并不是实际使用的电感）</p><p>其他芯片型号见原理图，电阻、电容实际使用数值与原理图相同，但型号可能不同。其中EG2104的自举电容用的NP0陶瓷电容。</p><h1 id="电路设计">电路设计</h1><h2 id="原理图">原理图</h2><p><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/sch1.png" alt="img"><br><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/sch2.png" alt="img"></p><p>图一为核心升降压部分，图中4V8为一级降压后的输出电压4.8V，经测试，若供电电压较低（以4.3V为例测试），则整体带载能力不足，表现为PWM占空比极低时输出两颗MOS无法被驱动。且考虑到赛题最低5V供电，所以最终采取一级降压4.8V、自举电容100nF的方案。</p><p>图二为辅助电源部分，输入电压经过一级降压为4.8V，再经过二级降压为数字3.3V和模拟3.3V，再经过三级降压为模拟2.5V。</p><h2 id="PCB">PCB</h2><p><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/pcb1.png" alt="img"></p><p>上图为主要电流路径，两个白色线框为回路区域示意，左侧输入端有一片保险丝和一片TVS、右侧输出端有一片TVS，三者起保护作用。右侧输出端使用一片5mΩ的电流采样电阻进行电流采样。板上共4个M3螺丝孔，便于后期将PCB固定于外壳。</p><p><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/pcb2.png" alt="img"></p><p>上图左侧为功率地、数字地、模拟地的连接部分，通过0Ω电阻单点连接。右侧白线框为电压采样的分压电阻，采样电压输出后连接到单片机的内置运放，通过内置运放连接到ADC进行采样。</p><h1 id="软件程序">软件程序</h1><h2 id="主程序">主程序</h2><p>MCU使用CUBEMX初始化，配置高精度定时器输出两路互补PWM波，其频率为200kHz。配置内部运放为电压跟随器模式，与ADC连接，ADC采样精度为12位。配置串口DMA，以及串口接收中断。配置主程序定时器频率1kHz。</p><ul><li>程序流程图如下图所示：</li></ul><p><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/flow.png" alt="img"></p><h2 id="PID控制部分">PID控制部分</h2><ul><li>CV部分pid模型：</li></ul><p><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/pid.png" alt="img"></p><p>此部分使用MATLAB中的Simulink建模，并生成代码，部署到单片机上，作为程序的PID计算部分。</p><h1 id="实物展示">实物展示</h1><p><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/pic1.jpg" alt="img"><br><img src="https://img-host-3w9.pages.dev/img/article/CNC-Power-Supply/pic2.jpg" alt="img"></p><h1 id="总结">总结</h1><p>经测试，此数控电源可以实现5~12V输入，0~12V、0~2A输出，0.1V电压步进，0.1A电流步进，0.01V电压测量精度，0.01A电流测量精度，输出误差非常小，稳定性高，可以很好地满足赛题需求。(参赛队伍：此方。成员：Poria Cocos)</p><h1 id="改进方向">改进方向</h1><ul><li>本系统Buck-Boost为双模态（两路互补PWM波），无需区分升压或降压。可以换成三模态（建议添加输入电压采样，程序自动更改升压or降压模式）。</li><li>pid响应不算快，有较大改进空间，CV和CC切换时不是很流畅。</li><li>如果不需要5V输入，一级降压可以高一点，提高EG2104带载能力。</li><li>输入输出的13V的TVS和5A保险丝是专为本赛题设计，可以更换，以达到更宽的输入输出范围，具体的极限还未测试。</li><li>带载时恒流模式实测值比显示值低，输出2A时低0.1~0.2A，应该是电流采样问题。</li></ul><h1 id="开源链接">开源链接</h1><ul><li>嘉立创：<a href="https://oshwhub.com/poria_cocos/2024-zeng-xin-bei-d-ti-shu-kong-dian-yuan">https://oshwhub.com/poria_cocos/2024-zeng-xin-bei-d-ti-shu-kong-dian-yuan</a></li><li>Github：<a href="https://github.com/Poria-Cocos/CNC_Power_Supply">https://github.com/Poria-Cocos/CNC_Power_Supply</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Projects </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电源 </tag>
            
            <tag> 数控电源 </tag>
            
            <tag> 电赛 </tag>
            
            <tag> 电压采样 </tag>
            
            <tag> 电流采样 </tag>
            
            <tag> PID </tag>
            
            <tag> Buck-Boost </tag>
            
            <tag> 开源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/aritcles/d87f7e0c.html"/>
      <url>/aritcles/d87f7e0c.html</url>
      
        <content type="html"><![CDATA[<h1 id="测试文章test123">测试文章test123</h1><h2 id="文章内容">文章内容</h2><p>1234567890<br>qwertyuiop</p><p>一二三四五六七八九十</p><h2 id="article-words">article words</h2><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Q</mi><mrow><mi mathvariant="normal">g</mi><mtext> </mtext><mi mathvariant="normal">t</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">p</mi></mrow></msub><mo>=</mo><mn>1</mn><mspace linebreak="newline"></mspace><mn>9</mn><mi mathvariant="normal">n</mi><mi mathvariant="normal">C</mi><mo separator="true">,</mo><mtext> </mtext><msub><mi mathvariant="normal">V</mi><mrow><mi mathvariant="normal">G</mi><mi mathvariant="normal">S</mi></mrow></msub><mo>=</mo><mn>10</mn><mi mathvariant="normal">V</mi><mo separator="true">,</mo><mtext> </mtext><msub><mi mathvariant="normal">R</mi><mrow><mi mathvariant="normal">D</mi><mi mathvariant="normal">S</mi></mrow></msub><mo>=</mo><mn>3.1</mn><mtext> </mtext><mi mathvariant="normal">m</mi><mi mathvariant="normal">Ω</mi></mrow><annotation encoding="application/x-tex">\mathrm{ Q_{g \ typ} = 1 \newline 9 nC, \ V_{GS} = 10 V, \ R_{DS} = 3.1 \, m \Omega }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">g</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathrm mtight">typ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">1</span><span class="mspace newline"></span><span class="mord mathrm">9nC</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.01389em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0139em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">GS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">10V</span><span class="mpunct">,</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">DS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathrm">3.1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">mΩ</span></span></span></span></span></p><h1 id="第二章">第二章</h1><h2 id="2-1">2.1</h2><h3 id="2-1-1">2.1.1</h3><h3 id="2-1-2">2.1.2</h3><h2 id="2-2">2.2</h2><!-- flag of hidden posts -->]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
